"use strict";var e;((e=e||{}).controls=e.controls||{},e.dialogs=e.dialogs||{},e.cms={htmlFiles:{},regexUrlStoreAdmin:/\/store-admin\/\d*\/([\w-]*)/,init:function(t){e.util.preloadImages("/res/svg/",["icon-navbar-active.svg","icon-close-hover.svg"]),this.htmlFiles=t,e.util.setupTemplateFormatters(),e.dialogs.init(),e.routerBase.init(),e.routerBase.loadPageForRoute(null,"cms")},onPageChanged:function(t){e.cms.navbar.init(t)},normalizeRoute:function(e){var t=!1,o=e;return this.regexUrlStoreAdmin.exec(e)&&(o="/store-admin/:id/"+(o=o.split("/"))[o.length-1],t=!0),{route:o,match:t}},routes:{"/store-admin/:id/business":{file:"business",initFunction:function(t){document.title=e.Strings.business,e.cms.business.init(t)}},"/store-admin/:id/dashboard":{file:"dashboard",initFunction:function(t){document.title=e.Strings.dashboard,e.cms.dashboard.init(t)}},"/store-admin/:id/delivery-suburbs":{file:"delivery-suburbs",initFunction:function(t){document.title=e.Strings.deliverySuburbs,e.cms.deliverySuburbs.init(t)}},"/store-admin/:id/menu":{file:"menu",initFunction:function(t){document.title=e.Strings.menu,e.cms.menu.init(t)}},"/store-admin/:id/orders":{file:"orders",initFunction:function(t){document.title=e.Strings.orders,e.cms.orders.init(t)}},"/store-admin/:id/details":{file:"details",initFunction:function(t){document.title=e.Strings.details,e.cms.details.init(t)}},"/store-admin/:id/transactions":{file:"transactions",initFunction:function(t){document.title=e.Strings.transactions,e.cms.transactions.init(t)}}}},e.cms.routesList=Object.keys(e.cms.routes),e.cms.business={init:function(){}},e.cms.dashboard={init:function(){}},e.cms.deliverySuburbs={init:function(){}},e.cms.details={init:function(){var t=this;e.storeContent.init(),this.$storeInfoEdit=$("#store-info-edit"),this.$previewBorder=$("#preview-mode-border"),this.$returnButton=$(".page-cms-details-return"),this.$previewButton=$(".page-cms-details-preview"),this.$detailsForm=$("#store-info-edit");var o=0;this.typeahead=new e.controls.Typeahead(function(e,t){}),e.data.getStoreData(function(e){t.setupPage(e)}),$("#typeahead-suburb > label").text("Suburb"),this.$returnButton.on("click",function(){$(this).hide(),t.$previewButton.show(),t.$previewBorder.hide(),t.$storeInfo.hide(),t.$storeInfoEdit.show(),$("html, body").animate({scrollTop:o},200)}),this.$previewButton.on("click",function(){o=$("html").scrollTop(),$(this).hide(),t.$previewButton.show(),t.$previewBorder.show(),t.$storeInfoEdit.hide(),t.$storeInfo.show()}),$(".fileupload").on("change",function(t){t.target.files.length>0&&(e.storeContent.$logoEmpty.hide(),e.storeContent.$logoLoading.show(),e.util.uploadImage(t.target.files,function(o){if(o)e.util.showToast(o);else{var i=t.target.files[0],n=new FileReader;n.addEventListener("load",function(){e.storeContent.$logo.each(function(e,t){t.src=n.result}),e.storeContent.$logoEmpty.hide(),e.storeContent.$logoLoading.hide()},!1),n.addEventListener("error",function(){e.storeContent.$logoEmpty.hide(),e.storeContent.$logoLoading.hide()},!1),i&&n.readAsDataURL(i)}}))}),this.$storeInfoEdit.on("submit",function(){var o=validate.collectFormValues(this.$detailsForm[0],{trim:!0}),i=e.validationRules.validateHours(o);if(i)return e.util.showToast(i,5e3),!1;delete o.logo;var n=t.typeahead.getValue();return o.suburb=n.suburb,o.postcode=n.postcode,!!e.util.validateInputs(o,e.validationRules.updateStoreDetails)&&(e.util.ajaxRequest({method:"POST",url:"/api/v1/store-update-details",data:o,auth:!0},function(t,o){if(t)return!1;e.util.showToast(e.Strings.saved,null,"success")}),!1)})},setupPage:function(t){if(t){e.storeContent.addStoreDetailsDataToPage(t);var o=t.address[0];this.$storeInfoEdit[0][1].value=t.description,this.$storeInfoEdit[0][2].value=o.street_address,this.typeahead.setValue(o.postcode,o.suburb),this.$storeInfoEdit[0][4].value=t.phone_number,this.$storeInfoEdit[0][5].value=t.email,Object.keys(t.hours).forEach(function(e){0===e.indexOf("hours_")&&$("[name='"+e+"']").val("NULL"===t.hours[e]?"":t.hours[e])})}}},e.cms.menu={init:function(){var t=this;e.storeContent.init(),e.data.getStoreData(function(e){e&&t.setupPage(e)}),$(".cms-menu-return").on("click",function(){$("#store-info-inner").hide(),$("#store-info-edit").show(),$("#preview-mode-border").hide(),$(".cms-menu-preview").show(),$(".cms-menu-return").hide()}),$(".cms-menu-preview").on("click",function(){$("#store-info-edit").hide(),$("#store-info-inner").show(),$("#preview-mode-border").show(),$(".cms-menu-preview").hide(),$(".cms-menu-return").show()})},setupPage:function(t){t&&e.storeContent.addMenuDataToPage(t)}},e.cms.navbar={init:function(t){var o=new e.controls.Navbar(t),i=!1;$(".navbar-links a").removeClass("active"),$(".navbar-link-"+t.file).addClass("active");var n=e.data.getStoreIdFromStorage();$("#navbar-cms a").each(function(){var e=$(this).attr("href");$(this).attr("href",e.replace(":storeId",n))}),o.linkClicked=function(t,o){if(!i)return i=!0,setTimeout(function(){e.routerBase.loadPageForRoute(o,"cms"),i=!1},250),!1}}},e.cms.orders={init:function(){}},e.cms.transactions={init:function(){}},e.data={storeDataRequestNotAllowed:!1,storeData:{},getStoreData:function(t,o){"function"==typeof t&&(o=t,t=null);var i=this;if(this.storeDataRequestNotAllowed)return o(this.storeData);t=t||this.getStoreIdFromStorage();if(!e.util.validateInputs({id_store:t},e.validationRules.getStore))return!1;this.storeDataRequestNotAllowed=!0,setTimeout(function(){i.storeDataRequestNotAllowed=!1},2e3),e.util.ajaxRequest({method:"GET",url:"/api/v1/store?id_store="+t,cache:!0},function(e,t){if(!e)return t.data.hours=t.data.hours[0],i.storeData=t.data,o(i.storeData)})},isStoreOpen:function(t,o,i){if(!this.storeData||0===Object.keys(this.storeData).length)return null;var n={isDineinOpen:!1,isDeliveryOpen:!1},s=new Date,a=t||s.getHours()+":"+s.getMinutes(),r=moment(a,"HH:mm").add(i||0,"days"),l=o||e.util.getTodayName(),u=this.storeData.hours["hours_"+l+"_dinein_open"],d=this.storeData.hours["hours_"+l+"_dinein_close"],c=this.storeData.hours["hours_"+l+"_delivery_open"],h=this.storeData.hours["hours_"+l+"_delivery_close"];if("NULL"!==u&&"NULL"!==d){var m=moment(u,"HH:mm"),p=moment(d,"HH:mm");p.isBefore(m)&&p.add(1,"days"),(u===a||r.isBetween(m,p))&&(n.isDineinOpen=!0)}if("NULL"!==c&&"NULL"!==h){var g=moment(c,"HH:mm"),_=moment(h,"HH:mm");_.isBefore(g)&&_.add(1,"days"),(c===a||r.isBetween(g,_))&&(n.isDeliveryOpen=!0)}return n},getWhenStoreOpensOrClosesNext:function(e,t,o){if(!this.storeData||0===Object.keys(this.storeData).length)return null;var i=this.isStoreOpen(e,t,o);i.isDineinOpen},getCheckoutData:function(){var e=window.sessionStorage.getItem("cod");try{e=JSON.parse(e)}catch(e){}return e||(e=[]),e},setCheckoutData:function(e){window.sessionStorage.setItem("cod",JSON.stringify(e))},addJwtToStorage:function(e){localStorage.setItem("jwt",e)},getJwtFromStorage:function(){var t=localStorage.getItem("jwt");return e.util.checkIfString(t)?t:null},addPersonIdToStorage:function(e){localStorage.setItem("pid",e)},getPersonIdFromStorage:function(){var t=Number(localStorage.getItem("pid"));return e.util.checkIfPositiveInteger(t)?t:null},addStoreIdToStorage:function(e){localStorage.setItem("sid",e)},getStoreIdFromStorage:function(){var t=Number(localStorage.getItem("sid"));return e.util.checkIfPositiveInteger(t)?t:null},invalidateTokensAndGoToLogin:function(){localStorage.removeItem("jwt"),localStorage.removeItem("pid"),localStorage.removeItem("sid"),window.location.href="/login"}},e.dialogs.businessHours={init:function(){var e=this;this.$hoursLeft=$("#dialog-store-hours-left"),this.$hoursRight=$("#dialog-store-hours-right"),$("#dialog-store-hours-close").on("click",function(){e.hide()})},update:function(t){if(t){for(var o=e.util.days,i=e.util.getTodayName(),n=document.createDocumentFragment(),s=0;s<o.length;s++)n.appendChild($(this.getHoursRow(t,o[s],!0,i===o[s]))[0]);this.$hoursLeft.append(n),n=document.createDocumentFragment();for(s=0;s<o.length;s++)n.appendChild($(this.getHoursRow(t,o[s],!1,i===o[s]))[0]);this.$hoursRight.append(n)}},getHoursRow:function(e,t,o,i){var n="hours_"+t.toLowerCase()+"_"+(o?"dinein":"delivery"),s=n+"_open",a=n+"_close",r=e[s];r="null"===r.toLowerCase()?"closed":e[s]+" to "+e[a];var l="";return i&&(l="today"),"<li class='"+l+"'><span>"+t+"</span> "+r+"</li>"},show:function(){e.dialogs.show("#dialog-store-hours")},hide:function(){e.dialogs.hide()}},e.dialogs.description={init:function(){var e=this;$("#dialog-store-description-close").on("click",function(){e.hide()})},update:function(e,t){$("#dialog-store-description-heading").text(e),$("#dialog-store-description-text").text(t)},show:function(){e.dialogs.show("#dialog-store-description")},hide:function(){e.dialogs.hide()}},e.dialogs.init=function(){Object.keys(this).forEach(function(t){e.dialogs[t].init&&e.dialogs[t].init()}),this.$dialogContainer=$("#dialog-container"),this.$dialogs=this.$dialogContainer.children(),this.$dialogContainer.on("click",function(){})},e.dialogs.show=function(e){this.$dialogContainer.show(),$(e).show()},e.dialogs.hide=function(){this.$dialogs.hide(),this.$dialogContainer.hide()},e.dialogs.reviews={init:function(){var t=this;$("#dialog-store-reviews-add-review").on("click",function(){e.util.showToast("not working yet")}),$("#dialog-store-reviews-close").on("click",function(){t.hide()})},update:function(e){},show:function(){e.dialogs.show("#dialog-store-reviews")},hide:function(){e.dialogs.hide()}},e.routerBase={firstLoad:!0,lastLoadedSection:"",isLoading:!1,init:function(){document.addEventListener("deviceready",function(){e.cordova.init()},!1)},loadPageForRoute:function(t,o,i){var n=this;if(!this.isLoading&&(window.location.pathname!==t||i)){this.isLoading=!0,this.lastLoadedSection=o,$(window).off(),$(document).off(),window.onpopstate=function(){n.loadPageForRoute(window.location.pathname,n.lastLoadedSection,!0)};var s=t||window.location.pathname,a={route:s};if(e.util.isCordova()&&"/index-cordova"==(s=s.substring(s.lastIndexOf("/"),s.length-5))&&(s="/"),a.normalizedRoute=e[o].normalizeRoute(s).route,a.section=o,-1!==e[o].routesList.indexOf(a.normalizedRoute))return a.html=e[o].htmlFiles[a.normalizedRoute],$.extend(a,e[o].routes[a.normalizedRoute]),$("#page-container").empty(),$("#page-container").append(a.html),$("html, body").animate({scrollTop:0},200),e[o].routes[a.normalizedRoute].initFunction(a),e[o].onPageChanged(a),$("body").css("visibility","visible"),this.firstLoad||i||a.route!=window.location.pathname&&window.history.pushState(null,a.route,a.route),this.firstLoad=!1,this.isLoading=!1,a;e.data.invalidateTokensAndGoToLogin()}},logUserOut:function(){e.util.ajaxRequest({method:"GET",url:"/api/v1/logout",auth:!0},function(){e.data.invalidateTokensAndGoToLogin()})},isUserLoggedIn:function(){var t=e.data.getJwtFromStorage();return t&&t.length>30}},e.storeContent={init:function(){this.$storeInfo=$("#store-info"),this.$logo=$(".store-info-image"),this.$description=$("#store-info-description"),this.$logoEmpty=$(".store-info-image-empty"),this.$logoLoading=$(".store-info-image-loading"),this.$descriptionButton=$("#store-info-button-description"),this.$hoursButton=$("#store-info-button-hours"),this.$reviewsButton=$("#store-info-button-reviews"),this.$menuList=$("#store-menu-list"),this.$logoEmpty.hide(),this.$logoLoading.show(),this.$descriptionButton.on("click",function(){e.dialogs.description.show()}),this.$hoursButton.on("click",function(){e.dialogs.businessHours.show()}),this.$reviewsButton.on("click",function(){e.dialogs.reviews.show()})},resizeDescription:function(){this.$description[0].scrollHeight>this.$description.innerHeight()?this.$descriptionButton.show():this.$descriptionButton.hide()},addStoreDetailsDataToPage:function(t,o){o||(o=t,t=null);var i=this;if(t=t||e.data.getStoreIdFromStorage()){var n=new Image;n.src="/res/storelogos/store"+t+".jpg?"+Date.now(),n.onload=function(){i.$logo.attr("src",n.src),i.$logoEmpty.hide(),i.$logoLoading.hide()},n.onerror=function(){i.$logoLoading.hide(),i.$logoEmpty.show()};var s=o.address[0];s=s.street_address+" "+s.suburb+" "+s.postcode,$("#store-header-name").text(o.name),this.$description.text(o.description),$("#store-info-address").text(s),$("#store-info-phone-number").text(o.phone_number),$("#store-info-email").text(o.email),$("#store-disclaimer").text(o.disclaimer),$("#store-info-review-count").text("( "+o.review_count+" )"),$("#store-info-hours-is-open").text(),$("#store-info-hours-opens-at").text(),e.controls.RatingControls.setValue("#store-info-rating-control",Math.round(o.rating)),e.dialogs.description.update(o.name,o.description),e.dialogs.businessHours.update(o.hours),e.dialogs.reviews.update(o),$(window).on("resize",function(){i.resizeDescription()})}},addMenuDataToPage:function(t){var o=0,i=0,n=null,s=null,a=document.createDocumentFragment();if(t.products){for(o=0;o<t.products.length;o++){var r=(s=t.products[o]).options[0].price;for(i=0;i<s.options.length;i++)s.options[i].price<r&&(r=s.options[i].price);s.lowestOptionPrice=r,s.gluten_free&&(s.class1="label-gluten-free"),s.vegetarian&&(s.class2="label-vegetarian"),s.delivery_available||(s.class3="label-takeaway");var l=(n=e.util.loadTemplate("#template-store-menu-item",s,s.id_product,"data-product-id")).find(".store-menu-list-item-options > .store-menu-list-item-content").last(),u=null,d=s.options.length;for(i=0;i<s.options.length;i++)u=e.util.loadTemplate("#template-store-menu-option",s.options[i],s.options[i].id_product_option,"data-product-option-id"),screen.width>1e3&&u.css({width:100/d+"%"}),l.append(u[0]);a.append(n[0])}for(o=0;o<t.product_headings.length;o++){var c=t.product_headings[o],h=$(a).find(".store-menu-list-item[data-product-id='"+c.above_product_id+"']");h&&(n=e.util.loadTemplate("#template-store-menu-heading",c,c.id_product_heading,"data-heading-id")).insertBefore(h)}this.$menuList.append(a),$(".store-menu-list-item-details").on("click",function(){$(".store-menu-list-item").removeClass("options-active"),$(this).parent().addClass("options-active")}),$(".store-menu-list-item-options-cancel").on("click",function(){$(this).parent().parent().removeClass("options-active")}),new e.controls.CategoryScroller(t.product_headings)}else this.$menuList.append(e.Strings.noProducts)},getProduct:function(e){if(!e)return null;for(var t=0;t<this.storeData.products.length;t++)if(this.storeData.products[t].id_product==e)return this.storeData.products[t];return null},getProductOption:function(e){if(!e)return null;for(var t=null,o=0;o<this.storeData.products.length;o++)if(t=this.storeData.products[o].options)for(var i=0;i<t.length;i++)if(t[i].id_product_option==e)return t[i];return null}},void 0===e)&&((e={}).Strings=e.Strings={});e.util={checkIfObject:function(e){return!!e&&(e&&"object"==typeof e&&e.constructor===Object)},checkIfString:function(e){return"string"==typeof e||e instanceof String},checkIfDate:function(e){return!!e&&(e instanceof Date&&isFinite(e))},checkIfPositiveInteger:function(e,t){var o=parseInt(e);return!isNaN(o)&&(o=Number(e),!!Number.isInteger(o)&&(t?o>=0:o>0))},validateInputs:function(e,t){if(!e||!this.checkIfObject(e)||0===Object.keys(e).length)return!1;if(!t)return!1;var o=validate(e,t,{format:"flat"});return!(o&&o.length>0)||(this.showToast(o[0]),!1)},days:function(){return[e.Strings.daysMon,e.Strings.daysTue,e.Strings.daysWed,e.Strings.daysThu,e.Strings.daysFri,e.Strings.daysSat,e.Strings.daysSun]},getTodayIndex:function(e){var t=e?e.getDay():(new Date).getDay();return-1==(t-=1)&&(t=6),t},getTodayName:function(e){return this.days()[this.getTodayIndex(e)]},getTomorrowName:function(e){var t=this.getTodayIndex(e)+1;return t>6&&(t=0),this.days()[t]},toTitleCase:function(e){return e?e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""},setupTemplateFormatters:function(){$.addTemplateFormatter({lowestOptionPriceFormatter:function(t){return e.Strings.fromDollar+t},priceFormatter:function(t){return e.Strings.fromDollar+t.toFixed(2)},categoryArrayFormatter:function(e){return e.join(", ")},phoneNumberFormatter:function(t){return e.Strings.phone+" "+t},deliveryFormatter:function(t){return e.Strings.delivery+" "+t},minOrderFormatter:function(t){return e.Strings.minOrder+" "+t}})},isCordova:function(){return"true"==$("#is-cordova").val()},showToast:function(e,t,o){var i=$("#toasts"),n=$("<p class='"+(o||"")+"'>"+e+"</p>");i.children().length>=5&&i.children().first().animate({opacity:0,bottom:-50},100,function(){$(this).remove()}),i.append(n[0]),i.show(),n.animate({opacity:1,bottom:0},100),setTimeout(function(){i.children().first().animate({opacity:0,bottom:-50},100,function(){$(this).remove()}),0===i.children().length&&i.hide().empty()},t||2e3)},showLoadingScreen:function(){$("#loading-screen").show()},hideLoadingScreen:function(){$("#loading-screen").hide()},loadTemplate:function(e,t,o,i){var n=$("<div></div>").loadTemplate($(e),t,{isFile:!1});return n=n.children().first().unwrap(),i&&n.attr(i,o),n},checkToken:function(t){var o=this,i=e.data.getJwtFromStorage();if(!e.util.validateInputs(i,e.validationRules._people_jwt))return e.data.invalidateTokensAndGoToLogin(),t(e.Strings.invalidToken);this.ajaxRequest({method:"POST",url:"/api/v1/check-token",auth:!0},function(i,n){return i?(o.invalidateCredentials(),t(e.Strings.invalidToken)):(e.data.addJwtToStorage(n.data.jwt),e.data.addPersonIdToStorage(n.data.id_person),n.data.id_store&&n.data.id_store>0&&e.data.addStoreIdToStorage(n.data.id_store),t(null))})},preloadImages:function(e,t){for(var o=[],i=0,n=0;n<t.length;n++)o.push(new Image),o[n].src=e+t[n],o[n].onload=function(){++i===o.length&&(o=null)}},uploadImage:function(t,o){if(t&&t.length>0){if(t[0].size>25e4)return void this.showToast(e.Strings.imageFileTooBig);var i=new FormData;i.append("logo",t[0]),i.append("id_store",e.data.getStoreIdFromStorage()),this.ajaxRequest({method:"POST",url:"/api/v1/store-update-logo",auth:!0,isImage:!0,data:i},function(t,i){return!t&&i&&i.data&&i.data.url?o(null,i.data.url):o(e.Strings.errorUploadingImage)})}else this.showToast(e.Strings.invalidImage)},ajaxRequest:function(t,o){var i=this,n="application/x-www-form-urlencoded; charser=UTF-8";t.isImage&&(n=!1);var s={method:t.method,url:t.url,data:t.data,cache:t.cache||!1,processData:!t.isImage,contentType:n,beforeSend:function(i){if(t.auth){var n=e.data.getJwtFromStorage();if(!e.util.validateInputs(n,e.validationRules._people_jwt))return i.abort(),e.data.invalidateTokensAndGoToLogin(),o(e.Strings.invalidToken);i.setRequestHeader("authorization","Bearer "+n)}},success:function(e){return o(null,e)},error:function(t){return t&&(t.responseJSON&&t.responseJSON.err?i.showToast(t.responseJSON.err,4e3):i.showToast(e.Strings.serverError,4e3)),o(t)}};t.dataType&&(s.dataType=t.dataType),$.ajax(s)}},e.validationRules={_sequence_id:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0}},_sequence_id_optional:{numericality:{onlyInteger:!0,greaterThan:0}},_email:{presence:!0,email:!0,length:{minimum:3,maximum:256}},_email_optional:{email:!0,length:{minimum:3,maximum:256}},_phone_number:{presence:!0,length:{minimum:3,maximum:32}},_phone_number_optional:{length:{minimum:3,maximum:32}},_url_link:{presence:!0,length:{maximum:256}},_url_link_optional:{length:{maximum:256}},_bit:{presence:!0,numericality:{onlyInteger:!0,greaterThanOrEqualTo:0,lessThanOrEqualTo:1}},_bit_optional:{numericality:{onlyInteger:!0,greaterThanOrEqualTo:0,lessThanOrEqualTo:1}},_notes_optional:{length:{maximum:256}},_price:{presence:!0,numericality:{greaterThanOrEqualTo:0}},_price_optional:{numericality:{greaterThanOrEqualTo:0}},_quantity:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0}},_latitude_optional:{numericality:{greaterThanOrEqualTo:0}},_longitude_optional:{numericality:{greaterThanOrEqualTo:0}},_addresses_street_address:{presence:!0,length:{maximum:256}},_people_first_name:{presence:!0,length:{minimum:2,maximum:45}},_people_first_name_optional:{length:{minimum:2,maximum:45}},_people_last_name:{presence:!0,length:{minimum:2,maximum:45}},_people_last_name_optional:{length:{minimum:2,maximum:45}},_people_password:{presence:!0,length:{minimum:3,maximum:64}},_people_reset_password_token:{presence:!0,length:64},_people_reset_password_token_optional:{presence:!0,length:64},_people_jwt:{presence:!0,length:{minimum:30,maximum:512}},_people_jwt_optional:{length:{minimum:30,maximum:512}},_people_verification_token:{presence:!0,length:64},_postcodes_postcode:{presence:!0,length:{minimum:1,maximum:6}},_postcodes_suburb:{presence:!0,length:{minimum:1,maximum:64}},_postcodes_state:{presence:!0,length:{minimum:1,maximum:32}},_reviews_title:{presence:!0,length:{minimum:2,maximum:128}},_reviews_review_optional:{length:{maximum:512}},_reviews_rating:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0,lessThan:6}},_stores_name:{presence:!0,length:{maximum:512}},_stores_description_optional:{length:{maximum:1024}},_stores_abn:{presence:!0,length:{minimum:10,maximum:32}},_stores_bank_name:{presence:!0,length:{minimum:2,maximum:128}},_stores_bank_bsb:{presence:!0,length:{minimum:6,maximum:16}},_stores_bank_account_name:{presence:!0,length:{minimum:2,maximum:128}},_stores_bank_account_number:{presence:!0,length:{minimum:2,maximum:32}},_stores_hours:{length:{maximum:5}},_product_extras_name:{presence:!0,length:{maximum:32}},_product_options_name:{presence:!0,length:{maximum:32}},_products_name:{presence:!0,length:{maximum:64}},_products_description_optional:{length:{maximum:256}},_order_products_customer_notes_optional:{length:{maximum:256}},_orders_notes_optional:{length:{maximum:256}},_orders_expiry:{presence:!0,datetime:!0},_transactions_commission:{presence:!0,numericality:{greaterThanOrEqualTo:0,lessThanOrEqualTo:1e3}},_transactions_processing_fee:{presence:!0,numericality:{greaterThanOrEqualTo:0,lessThanOrEqualTo:1e3}}},e.validationRules.login={email:e.validationRules._email,password:e.validationRules._people_password},e.validationRules.createUser={first_name:e.validationRules._people_first_name,last_name:e.validationRules._people_last_name,email:e.validationRules._email,password:e.validationRules._people_password,confirmPassword:{equality:"password"}},e.validationRules.storeApplication={name:{presence:!0,length:{maximum:128}},email:e.validationRules._email,message:{length:{maximum:256}}},e.validationRules.forgotPassword={email:e.validationRules._email},e.validationRules.verifyAccount={email:e.validationRules._email,password:e.validationRules._people_password,verification_token:e.validationRules._people_verification_token},e.validationRules.resetPassword={email:e.validationRules._people_email,password:e.validationRules._people_password,confirmPassword:{equality:"password"},reset_password_token:e.validationRules._people_reset_password_token},e.validationRules.createStore={postcode:e.validationRules._postcodes_postcode,suburb:e.validationRules._postcodes_suburb,street_address:e.validationRules._addresses_street_address,first_name:e.validationRules._people_first_name,last_name:e.validationRules._people_last_name,phone_number_user:e.validationRules._phone_number,email_user:e.validationRules._email,password:e.validationRules._people_password,name:e.validationRules._stores_name,abn:e.validationRules._stores_abn,internal_notes_store:e.validationRules._notes_optional},e.validationRules.deleteStore={id_store:e.validationRules._sequence_id},e.validationRules.updateStoreDetails={description:e.validationRules._stores_description_optional,street_address:e.validationRules._addresses_street_address,postcode:e.validationRules._postcodes_postcode,suburb:e.validationRules._postcodes_suburb,phone_number:e.validationRules._phone_number,email:e.validationRules._phone_email,hours_mon_dinein_open:e.validationRules._stores_hours,hours_tue_dinein_open:e.validationRules._stores_hours,hours_wed_dinein_open:e.validationRules._stores_hours,hours_thu_dinein_open:e.validationRules._stores_hours,hours_fri_dinein_open:e.validationRules._stores_hours,hours_sat_dinein_open:e.validationRules._stores_hours,hours_sun_dinein_open:e.validationRules._stores_hours,hours_mon_dinein_close:e.validationRules._stores_hours,hours_tue_dinein_close:e.validationRules._stores_hours,hours_wed_dinein_close:e.validationRules._stores_hours,hours_thu_dinein_close:e.validationRules._stores_hours,hours_fri_dinein_close:e.validationRules._stores_hours,hours_sat_dinein_close:e.validationRules._stores_hours,hours_sun_dinein_close:e.validationRules._stores_hours,hours_mon_delivery_open:e.validationRules._stores_hours,hours_tue_delivery_open:e.validationRules._stores_hours,hours_wed_delivery_open:e.validationRules._stores_hours,hours_thu_delivery_open:e.validationRules._stores_hours,hours_fri_delivery_open:e.validationRules._stores_hours,hours_sat_delivery_open:e.validationRules._stores_hours,hours_sun_delivery_open:e.validationRules._stores_hours,hours_mon_delivery_close:e.validationRules._stores_hours,hours_tue_delivery_close:e.validationRules._stores_hours,hours_wed_delivery_close:e.validationRules._stores_hours,hours_thu_delivery_close:e.validationRules._stores_hours,hours_fri_delivery_close:e.validationRules._stores_hours,hours_sat_delivery_close:e.validationRules._stores_hours,hours_sun_delivery_close:e.validationRules._stores_hours},e.validationRules.getStore={id_store:e.validationRules._sequence_id},e.validationRules.validateHours=function(t){if(!t||0===Object.keys(t).length)return"Data missing";for(var o=null,i=null,n=Object.keys(t),s=0;s<n.length;s++)if(0===n[s].indexOf("hours_"))if(t[n[s]]){if(5!==t[n[s]].length||!t[n[s]].match(/\d{2}:\d{2}/))return i=(o=n[s].split("_"))[1]+" "+o[2]+" "+o[3],"Error in Hours "+(i=e.util.toTitleCase(i))+".  Must be HH:MM"}else{var a="open"===(o=n[s].split("_"))[3]?"close":"open";if(i=o[1]+" "+o[2]+" "+o[3],i=e.util.toTitleCase(i),t[o=o[0]+"_"+o[1]+"_"+o[2]+"_"+a])return"Error in Hours "+i+".  Open and Close must be both times or both closed"}return null},e.controls.CategoryScroller=function(t){var o=$("html"),i=".category-scroller-list",n=$(".category-scroller-container"),s=$(".category-scroller"),a=$(i),r=[],l=$(".store-menu-list-item.heading"),u=0,d=[];function c(){d=[],l.each(function(){d.push(this.getBoundingClientRect().top+o.scrollTop())})}function h(){var e=o.scrollTop();for(u=d.length-1;u>=0;u--)if(e>d[u]-110){r.removeClass("active"),$(r[u]).addClass("active");break}}var m=null,p=document.createDocumentFragment();for(u=0;u<t.length;u++)m=$("<li class='store-menu-nav-list-item'>"+t[u].title+"</li>"),p.append(m[0]);a.append(p),new e.controls.HorizontalScroller(i,function(e){var t=$(".store-menu-list-item.heading:contains('"+e.innerText+"')"),i=(screen.width,100);t[0]&&$("html").animate({scrollTop:t[0].getBoundingClientRect().top+o.scrollTop()-i},500)}),$(window).on("resize",function(){c(),h()}),$(window).on("scroll",function(){r.length&&(n[0].getBoundingClientRect().top<20?s.addClass("floating"):s.removeClass("floating"),h())}),r=$(".store-menu-nav-list-item"),c()},e.controls.Navbar=function(){var t=this;$(".navbar a").on("click",function(o){if("logout"==this.innerText.toLowerCase())return e.routerBase.logUserOut(),!1;var i=this.href.replace(window.location.origin,"");return t.linkClicked(o,i),!1}),$(".navbar-links-popup-button").on("click",function(){$(".navbar-links-popup").animate({right:0},200)}),$(".navbar-links-popup-close").on("click",function(){$(".navbar-links-popup").animate({right:-250},200)}),$(".navbar-icon").on("click",function(e){e.ctrlKey?window.location.href="/admin-login":window.location.href="/location/Balmoral-4171"})},e.controls.Navbar.prototype.linkClicked=function(){},e.controls.RatingControls={setValue:function(e,t){for(var o=$(e),i=0;i<t;i++)o.children().eq(i).addClass("active")},getValue:function(e){return $(e+" .rating-control-star.active").length},updateRatingControls:function(e){for(var t=0;t<e.length;t++)if(e[t].id_review)for(var o=$(".rating-control-stars.user[data-id='"+e[t].id_review+"']"),i=0;i<e[t].rating;i++)o.children().eq(i).addClass("active")},recreateRatingControlEvents:function(){$(".rating-control-star").off(),$(".rating-control-star").unbind();$(".rating-control-star").on("click",function(){$(this).hasClass("active")||$(this).siblings().hasClass("active")||!0,$(this).removeClass("active"),$(this).siblings().removeClass("active"),$(this).addClass("active"),$(this).prevAll().addClass("active")})}},e.controls.Resizer=function(e,t,o,i,n){var s=$(t),a=$(o),r=!1,l=0;s.on("mousedown",function(e){r=!0,e.clientX,e.clientY}),$(window).on("mousemove",function(e){e.preventDefault(),r&&(a.show(),l=window.innerHeight-e.clientY-i,a.height(l),n&&n())}),$(window).on("mouseup",function(){r=!1})},e.controls.HorizontalScroller=function(e,t){var o=this,i=!1;this.startMouseX=0;var n=0,s=!1;this.diff=0,this.scrollBlurTolerance=5,this.$scrollerList=$(e),this.$scrollBlurLeft=this.$scrollerList.prev(),this.$scrollBlurRight=this.$scrollerList.next(),this.$scrollerList.on("mousedown",function(e){i=!0,s=!1,o.startMouseX=e.clientX,n=$(this).scrollLeft()}),$(window).on("mousemove",function(e){i&&(e.stopPropagation(),o.$scrollerList.scrollLeft(n-(e.clientX-o.startMouseX)),o.isInsideTolerance(e.clientX)||(s=!0))}),$(window).on("mouseup",function(){i=!1}),this.$scrollerList.on("mouseup",function(e){if(!s)return t(e.target);s=!1}),this.$scrollerList.on("scroll",function(){o.updateScrollBlurs()}),$(window).on("resize",function(){o.updateScrollBlurs()}),this.updateScrollBlurs()},e.controls.HorizontalScroller.prototype.updateScrollBlurs=function(){this.$scrollerList[0].scrollLeft>this.scrollBlurTolerance?this.$scrollBlurLeft.show():this.$scrollBlurLeft.hide(),this.$scrollerList[0].scrollLeft+this.$scrollerList[0].clientWidth<this.$scrollerList[0].scrollWidth-this.scrollBlurTolerance?this.$scrollBlurRight.show():this.$scrollBlurRight.hide()},e.controls.HorizontalScroller.prototype.isInsideTolerance=function(e){return this.diff=e-this.startMouseX,this.diff>=-this.scrollBlurTolerance&&this.diff<=this.scrollBlurTolerance},e.controls.Typeahead=function(t){var o=this;this.$typeaheadInput=$("#typeahead-suburb-search"),this.$typeaheadList=$("#typeahead-suburb-list");var i=null;function n(e){var i={suburb:$(e).find(".typeahead-item-suburb").text(),postcode:$(e).find(".typeahead-item-postcode").text()};if(o.$typeaheadList.hide(),o.$typeaheadInput.attr("data-suburb",""),o.$typeaheadInput.attr("data-postcode",""),!i.suburb||!i.postcode)return t(null);o.setValue(i.postcode,i.suburb);var n=encodeURIComponent(i.suburb+"-"+i.postcode);return t(i,n)}this.baseUrl="/api/v1/location?q=",this.$typeaheadList.on("click",function(e){n(e.target)}),this.$typeaheadInput.on("focus",function(){this.setSelectionRange(0,this.value.length)}),this.$typeaheadInput.on("blur",function(){var e=o.getValue();e.suburb&&e.postcode?o.setValue(e.postcode,e.suburb):(o.$typeaheadInput.attr("data-suburb",""),o.$typeaheadInput.attr("data-postcode",""),o.$typeaheadInput.val(""))}),this.$typeaheadInput.on("keyup",function(t){var s=0,a=[],r=$(this).val().toLowerCase();if(27!=t.which)if(13!=t.which)if(38!=t.which)if(40!=t.which)clearTimeout(i),i=setTimeout(function(){if(r){var t=o.baseUrl+r;e.util.ajaxRequest({method:"GET",url:t},function(t,i){if(!t){var n=[];for(s=0;s<i.data.length;s++)n.push("<li class='typeahead-item'><label class='typeahead-item-postcode'>"+i.data[s].postcode+"</label><span>â™”</span><label class='typeahead-item-suburb'>"+e.util.toTitleCase(i.data[s].suburb)+"</label></li>");o.$typeaheadList.empty(),n.length>0?(o.$typeaheadList.append(n.join("")),o.$typeaheadList.show()):(o.$typeaheadList.show(),o.$typeaheadList.append("<li class='typeahead-item'>"+e.Strings.noResults+"</li>"))}})}else o.$typeaheadList.hide()},500);else for(a=$(".typeahead-item"),s=a.length-1;s>=0;s--){if($(a[s]).hasClass("active")){$(a[s]).removeClass("active"),$(a[s]).next().addClass("active");break}0==s&&$(a[0]).addClass("active")}else for(a=$(".typeahead-item"),s=0;s<a.length;s++){if($(a[s]).hasClass("active")){$(a[s]).removeClass("active"),$(a[s]).prev().addClass("active");break}s==a.length-1&&$(a[a.length-1]).addClass("active")}else{var l=$(".typeahead-item.active");l.length>0&&n(l[0])}}),$(window).on("mousedown",function(e){"typeahead-item"!=e.target.className&&o.$typeaheadList.hide()}),$(window).on("keydown",function(e){27==e.which&&o.$typeaheadList.hide()})},e.controls.Typeahead.prototype.setValue=function(e,t){this.$typeaheadInput.val(e+" - "+t),this.$typeaheadInput.attr("data-suburb",t),this.$typeaheadInput.attr("data-postcode",e)},e.controls.Typeahead.prototype.getValue=function(){return{suburb:this.$typeaheadInput.attr("data-suburb"),postcode:this.$typeaheadInput.attr("data-postcode")}};