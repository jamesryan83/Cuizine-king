"use strict";var e=e||{};e.controls=e.controls||{},e.dialogs=e.dialogs||{},e.cms={htmlFiles:{},regexUrlStoreAdmin:/\/store-admin\/\d*\/([\w-]*)/,init:function(t){e.util.preloadImages("/res/svg/",["icon-navbar-active.svg","icon-close-hover.svg"]),this.htmlFiles=t,e.util.setupTemplateFormatters(),e.dialogs.init(),e.routerBase.init(),e.routerBase.loadPageForRoute(null,"cms")},onPageChanged:function(t){e.cms.navbar.init(t)},normalizeRoute:function(e){var t=!1,i=e;return this.regexUrlStoreAdmin.exec(e)&&(i="/store-admin/:id/"+(i=i.split("/"))[i.length-1],t=!0),{route:i,match:t}},routes:{"/store-admin/:id/business":{title:"Business",file:"business",initFunction:function(t){e.cms.business.init(t)}},"/store-admin/:id/dashboard":{title:"Dashboard",file:"dashboard",initFunction:function(t){e.cms.dashboard.init(t)}},"/store-admin/:id/delivery-suburbs":{title:"Delivery Suburbs",file:"delivery-suburbs",initFunction:function(t){e.cms.deliverySuburbs.init(t)}},"/store-admin/:id/menu":{title:"Menu",file:"menu",initFunction:function(t){e.cms.menu.init(t)}},"/store-admin/:id/orders":{title:"Orders",file:"orders",initFunction:function(t){e.cms.orders.init(t)}},"/store-admin/:id/details":{title:"Details",file:"details",initFunction:function(t){e.cms.details.init(t)}},"/store-admin/:id/transactions":{title:"Transactions",file:"transactions",initFunction:function(t){e.cms.transactions.init(t)}}}},e.cms.routesList=Object.keys(e.cms.routes),e.cms.business={init:function(){}},e.cms.dashboard={init:function(){}},e.cms.deliverySuburbs={init:function(){}},e.cms.details={init:function(){var t=this;e.storeContent.init(),this.$storeInfo=$("#store-info"),this.$storeInfoEdit=$("#store-info-edit");var i=0;this.typeahead=new e.controls.Typeahead(function(e,t){}),e.storeContent.getStoreData(function(e){t.setupPage(e)}),$("#typeahead-suburb > label").text("Suburb"),$(".page-cms-details-return").on("click",function(){$(this).hide(),$(".page-cms-details-preview").show(),$("#preview-mode-border").hide(),t.$storeInfo.hide(),t.$storeInfoEdit.show(),$("html, body").animate({scrollTop:i},200)}),$(".page-cms-details-preview").on("click",function(){i=$("html").scrollTop(),$(this).hide(),$(".page-cms-details-return").show(),$("#preview-mode-border").show(),t.$storeInfoEdit.hide(),t.$storeInfo.show()}),$(".fileupload").on("change",function(t){t.target.files.length>0&&($(".store-info-image-empty").hide(),$(".store-info-image-loading").show(),e.util.uploadImage(t.target.files,function(i){if(i)e.util.showToast(i);else{var o=t.target.files[0],n=new FileReader;n.addEventListener("load",function(){e.storeContent.$logo.each(function(e,t){t.src=n.result}),$(".store-info-image-empty").hide(),$(".store-info-image-loading").hide()},!1),n.addEventListener("error",function(){$(".store-info-image-empty").hide(),$(".store-info-image-loading").hide()},!1),o&&n.readAsDataURL(o)}}))}),this.$storeInfoEdit.on("submit",function(){var i=validate.collectFormValues($("#store-info-edit")[0],{trim:!0}),o=e.validationRules.validateHours(i);if(o)return e.util.showToast(o,5e3),!1;delete i.logo;var n=t.typeahead.getValue();return i.suburb=n.suburb,i.postcode=n.postcode,!!e.util.validateInputs(i,e.validationRules.updateStoreDetails)&&(e.util.ajaxRequest({method:"POST",url:"/api/v1/store-update-details",data:i,auth:!0},function(t,i){if(t)return!1;e.util.showToast("SAVED",null,"success")}),!1)})},setupPage:function(t){if(t){e.storeContent.addStoreDetailsDataToPage(t);var i=t.address[0];this.$storeInfoEdit[0][1].value=t.description,this.$storeInfoEdit[0][2].value=i.street_address,this.typeahead.setValue(i.postcode,i.suburb),this.$storeInfoEdit[0][4].value=t.phone_number,this.$storeInfoEdit[0][5].value=t.email,Object.keys(t.hours).forEach(function(e){0===e.indexOf("hours_")&&$("[name='"+e+"']").val("NULL"===t.hours[e]?"":t.hours[e])})}}},e.cms.menu={init:function(){var t=this;e.storeContent.init(),e.storeContent.getStoreData(function(e){e&&t.setupPage(e)}),$(".cms-menu-return").on("click",function(){$("#store-info-inner").hide(),$("#store-info-edit").show(),$("#preview-mode-border").hide(),$(".cms-menu-preview").show(),$(".cms-menu-return").hide()}),$(".cms-menu-preview").on("click",function(){$("#store-info-edit").hide(),$("#store-info-inner").show(),$("#preview-mode-border").show(),$(".cms-menu-preview").hide(),$(".cms-menu-return").show()})},setupPage:function(t){t&&e.storeContent.addMenuDataToPage(t)}},e.cms.navbar={init:function(t){var i=new e.controls.Navbar(t),o=!1;$(".navbar-links a").removeClass("active"),$(".navbar-link-"+t.file).addClass("active");var n=e.util.getStoreIdFromStorage();$("#navbar-cms a").each(function(){var e=$(this).attr("href");$(this).attr("href",e.replace(":storeId",n))}),i.linkClicked=function(t,i){if(!o)return o=!0,setTimeout(function(){e.routerBase.loadPageForRoute(i,"cms"),o=!1},250),!1}}},e.cms.orders={init:function(){}},e.cms.transactions={init:function(){}},e.dialogs.businessHours={days:["MON","TUE","WED","THU","FRI","SAT","SUN"],init:function(){var e=this;$("#dialog-store-hours-close").on("click",function(){e.hide()})},update:function(e,t){this.addHoursToList(e.slice(0,7),"#dialog-store-hours-left"),this.addHoursToList(e.slice(7,14),"#dialog-store-hours-right");for(var i="",o=document.createDocumentFragment(),n=0;n<7;n++)i="c"===e[n].opens?"closed":e[n].opens+" to "+e[n].closes,o.append($("<li><span>"+this.days[n]+"</span> "+i+"</li>")[0]);$(t).empty().append(o)},show:function(){e.dialogs.show("#dialog-store-hours")},hide:function(){e.dialogs.hide()}},e.dialogs.description={init:function(){var e=this;$("#dialog-store-description-close").on("click",function(){e.hide()})},update:function(e,t){$("#dialog-store-description-heading").text(e),$("#dialog-store-description-text").text(t)},show:function(){e.dialogs.show("#dialog-store-description")},hide:function(){e.dialogs.hide()}},e.dialogs.init=function(){Object.keys(this).forEach(function(t){e.dialogs[t].init&&e.dialogs[t].init()}),this.$dialogContainer=$("#dialog-container"),this.$dialogs=this.$dialogContainer.children(),this.$dialogContainer.on("click",function(){})},e.dialogs.show=function(e){this.$dialogContainer.show(),$(e).show()},e.dialogs.hide=function(){this.$dialogs.hide(),this.$dialogContainer.hide()},e.dialogs.reviews={init:function(){var t=this;$("#dialog-store-reviews-add-review").on("click",function(){e.util.showToast("not working yet")}),$("#dialog-store-reviews-close").on("click",function(){t.hide()})},update:function(t){$("#dialog-store-reviews-count").text("( "+t.review_count+" )"),e.controls.RatingControls.setValue("#dialog-store-reviews-rating-control",Math.round(t.rating));for(var i=document.createDocumentFragment(),o=0;o<t.reviews.length;o++){var n="<li class='rating-control-star "+(t.reviews[o].rating>.5?"active":"")+"'></li><li class='rating-control-star "+(t.reviews[o].rating>1.5?"active":"")+"'></li><li class='rating-control-star "+(t.reviews[o].rating>2.5?"active":"")+"'></li><li class='rating-control-star "+(t.reviews[o].rating>3.5?"active":"")+"'></li><li class='rating-control-star "+(t.reviews[o].rating>4.5?"active":"")+"'></li>";i.append($("<div class='store-reviews-list-item'><div class='store-reviews-list-item-header'><ul class='rating-control inactive'>"+n+"</ul><label>"+t.reviews[o].title+"</label></div><p>"+t.reviews[o].review+"</p></div>")[0])}$("#dialog-store-reviews-list").empty().append(i)},show:function(){e.dialogs.show("#dialog-store-reviews")},hide:function(){e.dialogs.hide()}},e.i18n={},e.i18n.en={storeIdMissing:"Store Id missing",imageFileMissing:"Image file missing",imageFileWrongType:"Incorrect image type.  Only Jpg is supported",imageFileTooBig:"Image file size too big.  Must be < 250kB"},e.routerBase={firstLoad:!0,lastLoadedSection:"",isLoading:!1,init:function(){document.addEventListener("deviceready",function(){e.cordova.init()},!1)},loadPageForRoute:function(t,i,o){if(!this.isLoading&&window.location.pathname!==t){var n=this;this.isLoading=!0,this.lastLoadedSection=i,$(window).off(),$(document).off(),window.onpopstate=function(){n.loadPageForRoute(window.location.pathname,n.lastLoadedSection,!0)};var s=this.getCurrentRouteData(t,i);return $("#page-container").empty(),$("#page-container").append(s.html),$("html, body").animate({scrollTop:0},200),e[i].routes[s.normalizedRoute].initFunction(s),e[i].onPageChanged(s),$("body").css("display","block"),n.firstLoad||o||s.route!=window.location.pathname&&window.history.pushState(null,s.route,s.route),n.firstLoad=!1,n.isLoading=!1,document.title=s.title,s}},getCurrentRouteData:function(t,i){var o=t||window.location.pathname,n={route:o};if(e.util.isCordova()&&"/index-cordova"==(o=o.substring(o.lastIndexOf("/"),o.length-5))&&(o="/"),n.normalizedRoute=e[i].normalizeRoute(o).route,n.section=i,-1!==e[i].routesList.indexOf(n.normalizedRoute))return n.html=e[i].htmlFiles[n.normalizedRoute],$.extend(n,e[i].routes[n.normalizedRoute]),n;e.util.invalidateCredentialsAndGoToLogin()},logUserOut:function(){e.util.ajaxRequest({method:"GET",url:"/api/v1/logout",auth:!0},function(){e.util.invalidateCredentialsAndGoToLogin()})},isUserLoggedIn:function(){var t=e.util.getJwtFromStorage();return t&&t.length>30}},e.storeContent={storeDataRequestNotAllowed:!1,storeData:{},init:function(){this.$logo=$(".store-info-image"),this.$description=$("#store-info-description"),this.$logoEmpty=$(".store-info-image-empty"),this.$logoLoading=$(".store-info-image-loading"),this.$descriptionButton=$("#store-info-button-description"),this.$menuList=$("#store-menu-list"),this.$logoEmpty.hide(),this.$logoLoading.show(),this.id_store=e.util.getStoreIdFromStorage(),$("#store-info-button-description").on("click",function(){e.dialogs.description.show()}),$("#store-info-button-hours").on("click",function(){e.dialogs.businessHours.show()}),$("#store-info-button-reviews").on("click",function(){e.dialogs.reviews.show()})},resizeDescription:function(){this.$description[0].scrollHeight>this.$description.innerHeight()?this.$descriptionButton.show():this.$descriptionButton.hide()},addStoreDetailsDataToPage:function(t){var i=this,o=new Image;o.src="/res/storelogos/store"+this.id_store+".jpg?"+Date.now(),o.onload=function(){i.$logo.attr("src",o.src),i.$logoEmpty.hide(),i.$logoLoading.hide()},o.onerror=function(){i.$logoLoading.hide(),i.$logoEmpty.show()};var n=t.address[0];n=n.street_address+" "+n.suburb+" "+n.postcode,$("#store-header-name").text(t.name),this.$description.text(t.description),$("#store-info-address").text(n),$("#store-info-phone-number").text(t.phone_number),$("#store-info-email").text(t.email),$("#store-disclaimer").text(t.disclaimer),$("#store-info-review-count").text("( "+t.review_count+" )"),e.controls.RatingControls.setValue("#store-info-rating-control",Math.round(t.rating)),e.dialogs.description.init(t.name,t.description),e.dialogs.businessHours.init(t.hours),e.dialogs.reviews.init(t),$(window).on("resize",function(){i.resizeDescription()})},addMenuDataToPage:function(t){var i=0,o=0,n=null,s=null,a=document.createDocumentFragment();if(t.products){for(t.products[0].name="testest testest testest testestttestest testest testest testestt",t.product_headings[0].title="testest testest testest testestt",t.products[0].options[0].name="testest testest testest testestt",i=0;i<t.products.length;i++){var r=(s=t.products[i]).options[0].price;for(o=0;o<s.options.length;o++)s.options[o].price<r&&(r=s.options[o].price);s.lowestOptionPrice=r,s.gluten_free&&(s.class1="label-gluten-free"),s.vegetarian&&(s.class2="label-vegetarian"),s.delivery_available||(s.class3="label-takeaway");var l=(n=e.util.loadTemplate("#template-store-menu-item",s,s.id_product,"data-product-id")).find(".store-menu-list-item-options > div").first(),u=null,d=s.options.length;for(o=0;o<s.options.length;o++)(u=e.util.loadTemplate("#template-store-menu-option",s.options[o],s.options[o].id_product_option,"data-product-option-id")).css({width:100/d+"%"}),l.append(u[0]);a.append(n[0])}for(i=0;i<t.product_headings.length;i++){var c=t.product_headings[i],m=$(a).find(".store-menu-list-item[data-product-id='"+c.above_product_id+"']");m&&(n=e.util.loadTemplate("#template-store-menu-heading",c,c.id_product_heading,"data-heading-id")).insertBefore(m)}this.$menuList.append(a),$(".store-menu-list-item-details").on("click",function(){$(this).next().addClass("active")}),$(".store-menu-list-item-options-cancel").on("click",function(){$(this).parent().removeClass("active")}),new e.controls.CategoryScroller(t.product_headings)}else this.$menuList.append("No Products")},getStoreData:function(t){var i=this;return this.storeDataRequestNotAllowed?t(this.storeData):!!e.util.validateInputs({id_store:this.id_store},e.validationRules.getStore)&&(this.storeDataRequestNotAllowed=!0,setTimeout(function(){i.storeDataRequestNotAllowed=!1},2e3),void e.util.ajaxRequest({method:"GET",url:"/api/v1/store?id_store="+this.id_store,cache:!0},function(e,o){if(!e)return o.data.hours=o.data.hours[0],i.storeData=o.data,t(i.storeData)}))}},e.util={setupTemplateFormatters:function(){$.addTemplateFormatter({lowestOptionPriceFormatter:function(e){return"From $"+e},priceFormatter:function(e){return"$"+e.toFixed(2)},categoryArrayFormatter:function(e){return e.join(", ")},phoneNumberFormatter:function(e){return"Ph: "+e},deliveryFormatter:function(e){return"Delivery "+e},minOrderFormatter:function(e){return"Min. Order "+e}})},validateInputs:function(e,t){if(!t)return!1;var i=validate(e,t,{format:"flat"});return!(i&&i.length>0)||(this.showToast(i[0]),!1)},isCordova:function(){return"true"==$("#is-cordova").val()},showToast:function(e,t,i){var o=$("#toasts"),n=$("<p class='"+(i||"")+"'>"+e+"</p>");o.children().length>=5&&o.children().first().animate({opacity:0,bottom:-50},100,function(){$(this).remove()}),o.append(n[0]),o.show(),n.animate({opacity:1,bottom:0},100),setTimeout(function(){o.children().first().animate({opacity:0,bottom:-50},100,function(){$(this).remove()}),0===o.children().length&&o.hide().empty()},t||2e3)},showLoadingScreen:function(){$("#loading-screen").show()},hideLoadingScreen:function(){$("#loading-screen").hide()},toTitleCase:function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},loadTemplate:function(e,t,i,o){var n=$("<div></div>").loadTemplate($(e),t,{isFile:!1});return n=n.children().first().unwrap(),o&&n.attr(o,i),n},addJwtToStorage:function(e){localStorage.setItem("jwt",e)},getJwtFromStorage:function(){return localStorage.getItem("jwt")},addPersonIdToStorage:function(e){localStorage.setItem("pid",e)},getPersonIdFromStorage:function(){return Number(localStorage.getItem("pid"))},addStoreIdToStorage:function(e){localStorage.setItem("sid",e)},getStoreIdFromStorage:function(){return Number(localStorage.getItem("sid"))},invalidateCredentialsAndGoToLogin:function(){localStorage.removeItem("jwt"),localStorage.removeItem("pid"),localStorage.removeItem("sid"),window.location.href="/login"},checkToken:function(e){var t=this,i=this.getJwtFromStorage();if(!(i&&i.length>30))return this.invalidateCredentials(),e("invalid token");this.ajaxRequest({method:"POST",url:"/api/v1/check-token",auth:!0},function(i,o){return i?(t.invalidateCredentials(),e("invalid token")):(t.addJwtToStorage(o.data.jwt),t.addPersonIdToStorage(o.data.id_person),o.data.id_store&&o.data.id_store>0&&t.addStoreIdToStorage(o.data.id_store),e(null))})},preloadImages:function(e,t){for(var i=[],o=0,n=0;n<t.length;n++)i.push(new Image),i[n].src=e+t[n],i[n].onload=function(){++o===i.length&&(i=null)}},uploadImage:function(e,t){if(e&&e.length>0){if(e[0].size>25e4)return void this.showToast("Image file size too big.  Must be < 250kB");var i=new FormData;i.append("logo",e[0]),i.append("id_store",this.getStoreIdFromStorage()),this.ajaxRequest({method:"POST",url:"/api/v1/store-update-logo",auth:!0,isImage:!0,data:i},function(e,i){return!e&&i&&i.data&&i.data.url?t(null,i.data.url):t("Error uploading image")})}else this.showToast("Invalid Image")},ajaxRequest:function(t,i){var o=this,n="application/x-www-form-urlencoded; charser=UTF-8";t.isImage&&(n=!1);var s={method:t.method,url:t.url,data:t.data,cache:t.cache||!1,processData:!t.isImage,contentType:n,beforeSend:function(i){t.auth&&i.setRequestHeader("authorization","Bearer "+e.util.getJwtFromStorage())},success:function(e){return i(null,e)},error:function(e){return e&&(e.responseJSON&&e.responseJSON.err?o.showToast(e.responseJSON.err,4e3):o.showToast("Server Error",4e3)),i(e)}};t.dataType&&(s.dataType=t.dataType),$.ajax(s)}},e.validationRules={_sequence_id:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0}},_sequence_id_optional:{numericality:{onlyInteger:!0,greaterThan:0}},_email:{presence:!0,email:!0,length:{minimum:3,maximum:256}},_email_optional:{email:!0,length:{minimum:3,maximum:256}},_phone_number:{presence:!0,length:{minimum:3,maximum:32}},_phone_number_optional:{length:{minimum:3,maximum:32}},_url_link:{presence:!0,length:{maximum:256}},_url_link_optional:{length:{maximum:256}},_bit:{presence:!0,numericality:{onlyInteger:!0,greaterThanOrEqualTo:0,lessThanOrEqualTo:1}},_bit_optional:{numericality:{onlyInteger:!0,greaterThanOrEqualTo:0,lessThanOrEqualTo:1}},_notes_optional:{length:{maximum:256}},_price:{presence:!0,numericality:{greaterThanOrEqualTo:0}},_price_optional:{numericality:{greaterThanOrEqualTo:0}},_quantity:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0}},_latitude_optional:{numericality:{greaterThanOrEqualTo:0}},_longitude_optional:{numericality:{greaterThanOrEqualTo:0}},_addresses_street_address:{presence:!0,length:{maximum:256}},_people_first_name:{presence:!0,length:{minimum:2,maximum:45}},_people_first_name_optional:{length:{minimum:2,maximum:45}},_people_last_name:{presence:!0,length:{minimum:2,maximum:45}},_people_last_name_optional:{length:{minimum:2,maximum:45}},_people_password:{presence:!0,length:{minimum:3,maximum:64}},_people_reset_password_token:{presence:!0,length:64},_people_reset_password_token_optional:{presence:!0,length:64},_people_jwt:{presence:!0,length:{minimum:30,maximum:512}},_people_jwt_optional:{length:{minimum:30,maximum:512}},_people_verification_token:{presence:!0,length:64},_postcodes_postcode:{presence:!0,length:{minimum:1,maximum:6}},_postcodes_suburb:{presence:!0,length:{minimum:1,maximum:64}},_postcodes_state:{presence:!0,length:{minimum:1,maximum:32}},_reviews_title:{presence:!0,length:{minimum:2,maximum:128}},_reviews_review_optional:{length:{maximum:512}},_reviews_rating:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0,lessThan:6}},_stores_name:{presence:!0,length:{maximum:512}},_stores_description_optional:{length:{maximum:1024}},_stores_abn:{presence:!0,length:{minimum:10,maximum:32}},_stores_bank_name:{presence:!0,length:{minimum:2,maximum:128}},_stores_bank_bsb:{presence:!0,length:{minimum:6,maximum:16}},_stores_bank_account_name:{presence:!0,length:{minimum:2,maximum:128}},_stores_bank_account_number:{presence:!0,length:{minimum:2,maximum:32}},_stores_hours:{length:{maximum:5}},_product_extras_name:{presence:!0,length:{maximum:32}},_product_options_name:{presence:!0,length:{maximum:32}},_products_name:{presence:!0,length:{maximum:64}},_products_description_optional:{length:{maximum:256}},_order_products_customer_notes_optional:{length:{maximum:256}},_orders_notes_optional:{length:{maximum:256}},_orders_expiry:{presence:!0,datetime:!0},_transactions_commission:{presence:!0,numericality:{greaterThanOrEqualTo:0,lessThanOrEqualTo:1e3}},_transactions_processing_fee:{presence:!0,numericality:{greaterThanOrEqualTo:0,lessThanOrEqualTo:1e3}}},e.validationRules.login={email:e.validationRules._email,password:e.validationRules._people_password},e.validationRules.createUser={first_name:e.validationRules._people_first_name,last_name:e.validationRules._people_last_name,email:e.validationRules._email,password:e.validationRules._people_password,confirmPassword:{equality:"password"}},e.validationRules.storeApplication={name:{presence:!0,length:{maximum:128}},email:e.validationRules._email,message:{length:{maximum:256}}},e.validationRules.forgotPassword={email:e.validationRules._email},e.validationRules.verifyAccount={email:e.validationRules._email,password:e.validationRules._people_password,verification_token:e.validationRules._people_verification_token},e.validationRules.resetPassword={email:e.validationRules._people_email,password:e.validationRules._people_password,confirmPassword:{equality:"password"},reset_password_token:e.validationRules._people_reset_password_token},e.validationRules.createStore={postcode:e.validationRules._postcodes_postcode,suburb:e.validationRules._postcodes_suburb,street_address:e.validationRules._addresses_street_address,first_name:e.validationRules._people_first_name,last_name:e.validationRules._people_last_name,phone_number_user:e.validationRules._phone_number,email_user:e.validationRules._email,password:e.validationRules._people_password,name:e.validationRules._stores_name,abn:e.validationRules._stores_abn,internal_notes_store:e.validationRules._notes_optional},e.validationRules.deleteStore={id_store:e.validationRules._sequence_id},e.validationRules.updateStoreDetails={description:e.validationRules._stores_description_optional,street_address:e.validationRules._addresses_street_address,postcode:e.validationRules._postcodes_postcode,suburb:e.validationRules._postcodes_suburb,phone_number:e.validationRules._phone_number,email:e.validationRules._phone_email,hours_mon_dinein_open:e.validationRules._stores_hours,hours_tue_dinein_open:e.validationRules._stores_hours,hours_wed_dinein_open:e.validationRules._stores_hours,hours_thu_dinein_open:e.validationRules._stores_hours,hours_fri_dinein_open:e.validationRules._stores_hours,hours_sat_dinein_open:e.validationRules._stores_hours,hours_sun_dinein_open:e.validationRules._stores_hours,hours_mon_dinein_close:e.validationRules._stores_hours,hours_tue_dinein_close:e.validationRules._stores_hours,hours_wed_dinein_close:e.validationRules._stores_hours,hours_thu_dinein_close:e.validationRules._stores_hours,hours_fri_dinein_close:e.validationRules._stores_hours,hours_sat_dinein_close:e.validationRules._stores_hours,hours_sun_dinein_close:e.validationRules._stores_hours,hours_mon_delivery_open:e.validationRules._stores_hours,hours_tue_delivery_open:e.validationRules._stores_hours,hours_wed_delivery_open:e.validationRules._stores_hours,hours_thu_delivery_open:e.validationRules._stores_hours,hours_fri_delivery_open:e.validationRules._stores_hours,hours_sat_delivery_open:e.validationRules._stores_hours,hours_sun_delivery_open:e.validationRules._stores_hours,hours_mon_delivery_close:e.validationRules._stores_hours,hours_tue_delivery_close:e.validationRules._stores_hours,hours_wed_delivery_close:e.validationRules._stores_hours,hours_thu_delivery_close:e.validationRules._stores_hours,hours_fri_delivery_close:e.validationRules._stores_hours,hours_sat_delivery_close:e.validationRules._stores_hours,hours_sun_delivery_close:e.validationRules._stores_hours},e.validationRules.getStore={id_store:e.validationRules._sequence_id},e.validationRules.validateHours=function(t){if(!t||0===Object.keys(t).length)return"Data missing";for(var i=null,o=null,n=Object.keys(t),s=0;s<n.length;s++)if(0===n[s].indexOf("hours_"))if(t[n[s]]){if(5!==t[n[s]].length||!t[n[s]].match(/\d{2}:\d{2}/))return o=(i=n[s].split("_"))[1]+" "+i[2]+" "+i[3],"Error in Hours "+(o=e.util.toTitleCase(o))+".  Must be HH:MM"}else{var a="open"===(i=n[s].split("_"))[3]?"close":"open";if(o=i[1]+" "+i[2]+" "+i[3],o=e.util.toTitleCase(o),t[i=i[0]+"_"+i[1]+"_"+i[2]+"_"+a])return"Error in Hours "+o+".  Open and Close must be both times or both closed"}return null},e.controls.CategoryScroller=function(t){var i=$("html"),o=".category-scroller-list",n=$(".category-scroller-container"),s=$(".category-scroller"),a=$(o),r=[],l=$(".store-menu-list-item.heading"),u=($(".category-scroll-blur-left"),$(".category-scroll-blur-right"),0),d=[];function c(){d=[],l.each(function(){d.push(this.getBoundingClientRect().top+i.scrollTop())})}function m(){var e=i.scrollTop();for(u=d.length-1;u>=0;u--)if(e>d[u]-100){r.removeClass("active"),$(r[u]).addClass("active");break}}var h=document.createDocumentFragment();for(u=0;u<t.length;u++){var p=$("<li class='store-menu-nav-list-item'>"+t[u].title+"</li>");p.on("click",function(e){var t=$(".store-menu-list-item.heading:contains('"+e.target.innerText+"')"),o=80;screen.width<670&&(o=110),t[0]&&$("html").animate({scrollTop:t[0].getBoundingClientRect().top+i.scrollTop()-o},500)}),h.append(p[0])}a.append(h),new e.controls.HorizontalScroller(o,function(){}),$(window).on("scroll",function(){r.length&&(n[0].getBoundingClientRect().top<20?s.addClass("floating"):s.removeClass("floating"),m())}),$(window).on("resize",function(){c(),m()}),r=$(".store-menu-nav-list-item"),c()},e.controls.Navbar=function(){var t=this;$(".navbar a").on("click",function(i){if("logout"==this.innerText.toLowerCase())return e.routerBase.logUserOut(),!1;var o=this.href.replace(window.location.origin,"");return t.linkClicked(i,o),!1}),$(".navbar-links-popup-button").on("click",function(){$(".navbar-links-popup").animate({right:0},200)}),$(".navbar-links-popup-close").on("click",function(){$(".navbar-links-popup").animate({right:-250},200)}),$(".navbar-icon").on("click",function(e){e.ctrlKey?window.location.href="/admin-login":window.location.href="/location/Balmoral-4171"})},e.controls.Navbar.prototype.linkClicked=function(){},e.controls.RatingControls={setValue:function(e,t){for(var i=$(e),o=0;o<t;o++)i.children().eq(o).addClass("active")},getValue:function(e){return $(e+" .rating-control-star.active").length},updateRatingControls:function(e){for(var t=0;t<e.length;t++)if(e[t].id_review)for(var i=$(".rating-control-stars.user[data-id='"+e[t].id_review+"']"),o=0;o<e[t].rating;o++)i.children().eq(o).addClass("active")},recreateRatingControlEvents:function(){$(".rating-control-star").off(),$(".rating-control-star").unbind();$(".rating-control-star").on("click",function(){$(this).hasClass("active")||$(this).siblings().hasClass("active")||!0,$(this).removeClass("active"),$(this).siblings().removeClass("active"),$(this).addClass("active"),$(this).prevAll().addClass("active")})}},e.controls.Resizer=function(e,t,i,o){var n=$(t),s=$(i),a=!1;n.on("mousedown",function(e){a=!0,e.clientX,e.clientY}),$(window).on("mousemove",function(e){if(e.preventDefault(),e.stopPropagation(),a){var t=window.innerHeight-e.clientY-o;s.height(t)}}),$(window).on("mouseup",function(){a=!1})},e.controls.HorizontalScroller=function(e,t){var i=!1,o=0,n=0;$(e).on("mousedown",function(e){i=!0,o=e.clientX,n=$(this).scrollLeft()}),$(window).on("mousemove",function(t){i&&(t.stopPropagation(),$(e).scrollLeft(n-(t.clientX-o)))}),$(window).on("mouseup",function(){i=!1}),$(e).on("mouseup",function(e){var i=e.clientX-o;i>=-4&&i<=4&&t(e.target)})},e.controls.Typeahead=function(t){var i=this;this.$typeaheadInput=$("#typeahead-suburb-search"),this.$typeaheadList=$("#typeahead-suburb-list");var o=null;function n(e){var o={suburb:$(e).find(".typeahead-item-suburb").text(),postcode:$(e).find(".typeahead-item-postcode").text()};if(i.$typeaheadList.hide(),i.$typeaheadInput.attr("data-suburb",""),i.$typeaheadInput.attr("data-postcode",""),!o.suburb||!o.postcode)return t(null);i.setValue(o.postcode,o.suburb);var n=encodeURIComponent(o.suburb+"-"+o.postcode);return t(o,n)}this.baseUrl="/api/v1/location?q=",this.$typeaheadList.on("click",function(e){n(e.target)}),this.$typeaheadInput.on("focus",function(){this.setSelectionRange(0,this.value.length)}),this.$typeaheadInput.on("blur",function(){var e=i.getValue();e.suburb&&e.postcode?i.setValue(e.postcode,e.suburb):(i.$typeaheadInput.attr("data-suburb",""),i.$typeaheadInput.attr("data-postcode",""),i.$typeaheadInput.val(""))}),this.$typeaheadInput.on("keyup",function(t){var s=0,a=[],r=$(this).val().toLowerCase();if(27!=t.which)if(13!=t.which)if(38!=t.which)if(40!=t.which)clearTimeout(o),o=setTimeout(function(){if(r){var t=i.baseUrl+r;e.util.ajaxRequest({method:"GET",url:t},function(t,o){if(!t){var n=[];for(s=0;s<o.data.length;s++)n.push("<li class='typeahead-item'><label class='typeahead-item-postcode'>"+o.data[s].postcode+"</label><span>♔</span><label class='typeahead-item-suburb'>"+e.util.toTitleCase(o.data[s].suburb)+"</label></li>");i.$typeaheadList.empty(),n.length>0?(i.$typeaheadList.append(n.join("")),i.$typeaheadList.show()):(i.$typeaheadList.show(),i.$typeaheadList.append("<li class='typeahead-item'>NO RESULTS</li>"))}})}else i.$typeaheadList.hide()},500);else for(a=$(".typeahead-item"),s=a.length-1;s>=0;s--){if($(a[s]).hasClass("active")){$(a[s]).removeClass("active"),$(a[s]).next().addClass("active");break}0==s&&$(a[0]).addClass("active")}else for(a=$(".typeahead-item"),s=0;s<a.length;s++){if($(a[s]).hasClass("active")){$(a[s]).removeClass("active"),$(a[s]).prev().addClass("active");break}s==a.length-1&&$(a[a.length-1]).addClass("active")}else{var l=$(".typeahead-item.active");l.length>0&&n(l[0])}}),$(window).on("mousedown",function(e){"typeahead-item"!=e.target.className&&i.$typeaheadList.hide()}),$(window).on("keydown",function(e){27==e.which&&i.$typeaheadList.hide()})},e.controls.Typeahead.prototype.setValue=function(e,t){this.$typeaheadInput.val(e+" - "+t),this.$typeaheadInput.attr("data-suburb",t),this.$typeaheadInput.attr("data-postcode",e)},e.controls.Typeahead.prototype.getValue=function(){return{suburb:this.$typeaheadInput.attr("data-suburb"),postcode:this.$typeaheadInput.attr("data-postcode")}};