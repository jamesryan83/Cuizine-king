"use strict";var app;((app=app||{}).controls=app.controls||{},app.dialogs=app.dialogs||{},app.site={htmlFiles:{},regexUrlAccount:/\/account\/\d*/,regexUrlLocation:/\/location\/[\w\d%-]*-\d*/,regexUrlStore:/\/store\/\d*/,init:function(t){app.util.preloadImages("/res/svg/",["icon-navbar-active.svg","icon-close-hover.svg"]),this.htmlFiles=t,app.util.setupTemplateFormatters(),app.dialogs.init(),app.routerBase.init(),app.routerBase.loadPageForRoute(null,"site")},onPageChanged:function(t){app.site.navbar.init(t)},normalizeRoute:function(t){var e=!1,o=t;return this.regexUrlStore.exec(t)?(o="/store/:id",e=!0):this.regexUrlLocation.exec(t)?(o="/location/:suburb",e=!0):this.regexUrlAccount.exec(t)&&(o="/account/:id",e=!0),{route:o,match:e}},routes:{"/":{file:"home",initFunction:function(t){document.title=app.Strings.home,app.site.home.init(t)}},"/account/:id":{file:"account",initFunction:function(t){document.title=app.Strings.account,app.site.account.init(t)}},"/about":{file:"about",initFunction:function(){document.title=app.Strings.about}},"/help":{file:"help",initFunction:function(){document.title=app.Strings.help}},"/location/:suburb":{file:"location",initFunction:function(t){document.title=app.Strings.location,app.site.location.init(t)}},"/store/:id":{file:"store",initFunction:function(t){document.title=app.Strings.store,app.site.store.init(t)}},"/login":{file:"login",initFunction:function(t){document.title=app.Strings.login,app.site.login.init(t)}},"/store-login":{file:"login",initFunction:function(t){document.title=app.Strings.storeLogin,app.site.login.init(t)}},"/verify-account":{file:"verify-account",initFunction:function(t){document.title=app.Strings.verifyAccount,app.site.verifyAccount.init(t)}},"/reset-password":{file:"reset-password",initFunction:function(t){document.title=app.Strings.resetPassword,app.site.resetPassword.init(t)}},"/register":{file:"login",initFunction:function(t){document.title=app.Strings.resetPassword,app.site.login.init(t)}},"/store-application":{file:"login",initFunction:function(t){document.title=app.Strings.storeApplication,app.site.login.init(t)}}}},app.site.routesList=Object.keys(app.site.routes),app.site.account={init:function(){var t=this;app.util.ajaxRequest({method:"GET",url:"/api/v1/account",auth:!0},function(e,o){e?app.data.invalidateTokensAndGoToLogin():(console.log(o),t.afterInit())})},afterInit:function(){$(".page-content").show(),$("#delete-account").on("click",function(){app.util.showLoadingScreen(),app.util.ajaxRequest({method:"GET",url:"/api/v1/delete-user",auth:!0},function(t){app.util.hideLoadingScreen(),t||app.data.invalidateTokensAndGoToLogin()})})}},app.dialogs.addToOrder={dialogEl:"#dialog-store-add-to-order",dialogCloseEl:"#dialog-store-add-to-order-close",init:function(t){var e=this;$(this.dialogCloseEl).off().on("click",function(){e.hide()})},show:function(){$("#dialog-container").show(),$(this.dialogEl).show()},hide:function(){$("#dialog-container").hide(),$("#dialog-container > div").hide()}},app.site.home={init:function(){$("#download-app-logos > div").on("click",function(){app.util.showToast(app.Strings.notWorkingYet)}),$("#scooter").animate({left:screen.width+20},2e3,"linear")}},app.site.location={suburbs:[],storeData:[],suburbTimeout:null,pageWidth:0,regularHeadingWidth:0,locationHeadingWidth:0,headingContainerWidth:0,typeaheadWidth:0,init:function(t){var e=this;app.util.ajaxRequest({method:"GET",url:"/res/_stores.json"},function(t,o){t||(e.storeData=o,e.afterStoreDataLoaded())});var o=t.route.slice(0);if(0===o.indexOf("/location")){var i=o.replace("/location/","");i=i.split("-"),$("#location-header-location").text(decodeURIComponent(i[0])+" "+i[1])}},afterStoreDataLoaded:function(){for(var t=-1,e="",o=null,i=0;i<this.storeData.length;i++){e=(t=this.storeData[i].stores.length)+" "+(1==t?app.Strings.location:app.Strings.locations),$("#location-store-list").append("<div class='row-heading-container'><h3>"+this.storeData[i].category+"</h3><label class='row-heading-label'>"+e+"</label></div><hr class='hr-2' />");for(var a=document.createDocumentFragment(),n=0;n<this.storeData[i].stores.length;n++){(o=this.storeData[i].stores[n]).storeId="store"+o.id_store;var s=app.util.loadTemplate("#template-store-list-item",o,o.id_store,"data-store-id");s.find(".store-list-item-image").css({"background-image":"url("+o.image+")"});for(var r=Math.round(o.avgReview),l=s.find(".rating-control-static > div"),p=0;p<r;p++)$(l[p]).addClass("active");a.append(s[0])}var u=$("<div class='category-stores-row'><div class='scroll-blur-left'></div><div class='category-stores-row-inner'></div><div class='scroll-blur-right'></div></div>");u.find(".category-stores-row-inner").append(a),$("#location-store-list").append(u)}$(".category-stores-row-inner").each(function(t,e){new app.controls.HorizontalScroller(e,function(t){if(t){$(t).closest(".store-list-item")[0].id.replace("store","");1,app.routerBase.loadPageForRoute("/store/1","site")}})})}},app.site.login={init:function(t){var e=this;console.log("setup"),$("#form-login").on("submit",function(){var t=validate.collectFormValues($("#form-login")[0],{trim:!0});return!!app.util.validateInputs(t,app.validationRules.login)&&(app.util.ajaxRequest({method:"POST",url:"/api/v1/login",data:t},function(t,e){if(t)return!1;app.data.addJwtToStorage(e.data.jwt),app.data.addPersonIdToStorage(e.data.id_person),app.routerBase.loadPageForRoute("/account/"+e.data.id_person,"site")}),!1)}),$("#form-store-login").on("submit",function(){var t=validate.collectFormValues($("#form-store-login")[0],{trim:!0});return!!app.util.validateInputs(t,app.validationRules.login)&&(app.util.ajaxRequest({method:"POST",url:"/api/v1/store-login",data:t},function(t,e){if(t)return!1;app.data.addJwtToStorage(e.data.jwt),app.data.addPersonIdToStorage(e.data.id_person),app.data.addStoreIdToStorage(e.data.id_store),window.location.href="/store-admin/"+e.data.id_store+"/dashboard"}),!1)}),$("#form-register").on("submit",function(){if(!$("#checkbox-tnc").is(":checked"))return app.util.showToast(app.Strings.agreeToTnC),!1;var t=validate.collectFormValues($("#form-register")[0],{trim:!0});return!!app.util.validateInputs(t,app.validationRules.createUser)&&(app.util.ajaxRequest({method:"POST",url:"/api/v1/create-user",data:t},function(o,i){o||(app.data.addJwtToStorage(i.data.jwt),app.data.addPersonIdToStorage(i.data.id_person),$("#registration-success-email").text(t.email),e.showForm("#registration-success"))}),!1)}),$("#form-store-application").on("submit",function(){var t=validate.collectFormValues($("#form-store-application")[0],{trim:!0});return!!app.util.validateInputs(t,app.validationRules.storeApplication)&&(app.util.ajaxRequest({method:"POST",url:"/api/v1/store-application",data:t},function(o){o||($("#store-application-success-email").text(t.email),e.showForm("#store-application-success"))}),!1)}),$("#form-forgot-password").on("submit",function(){return app.util.showToast(app.Strings.notWorkingYet),!1}),$("#registration-success-account").on("click",function(){var t=app.data.getPersonIdFromStorage();t?window.location.href="/account/"+t:app.util.showToast(app.Strings.unableToGoToAccountPage)}),$("#store-application-success-home").on("click",function(){window.location.href="/"}),$("#login-goto-register").on("click",function(){e.showForm("#form-register",!0,!0,app.Strings.register,"register")}),$("#login-goto-store-login").on("click",function(){e.showForm("#form-store-login",!0,!1,app.Strings.storeLogin,"store-login")}),$("#store-login-goto-login").on("click",function(){e.showForm("#form-login",!0,!0,app.Strings.login,"login")}),$("#login-goto-store-application").on("click",function(){e.showForm("#form-store-application",!0,!0,app.Strings.storeApplication,"store-application")}),$("#login-forgot-password").on("click",function(){e.showForm("#form-forgot-password")}),$("#register-goto-login").on("click",function(){$("#checkbox-tnc").prop("checked",!1),e.showForm("#form-login",!0,!0,app.Strings.login,"login")}),$("#store-application-goto-login").on("click",function(){$("#checkbox-tnc-store").prop("checked",!1),e.showForm("#form-login",!0,!0,app.Strings.login,"login")}),$("#forgot-password-goto-login").on("click",function(){e.showForm("#form-login",!0,!0,app.Strings.register,"register")}),$(window).on("resize",function(){e.updateFormVisuals()}),setTimeout(function(){e.updateFormVisuals(),"/login"==t.route&&e.showForm("#form-login"),"/store-login"==t.route&&e.showForm("#form-store-login"),"/register"==t.route&&e.showForm("#form-register"),"/store-application"==t.route&&e.showForm("#form-store-application")},500)},showForm:function(t,e,o,i,a){$("#page-login .form-container-outer").addClass("hidden"),$(t).closest(".form-container-outer").removeClass("hidden"),e&&(o?$("#navbar-login").addClass("active"):$("#navbar-login").removeClass("active"),document.title=i,window.history.pushState(null,a,a)),$("html, body").animate({scrollTop:100},200)},updateFormVisuals:function(){$("#page-login form").each(function(t,e){var o=e.clientHeight,i=e.clientWidth,a=$(e).closest(".form-container-outer"),n=$(e).siblings(".form-container-inner");$(a).css({height:o,width:i}),$(n[0]).css({height:o-10,width:i-10}),$(n[1]).css({height:o-10,width:i-10})})}},app.site.navbar={init:function(t){var e=new app.controls.Navbar(t);$(".navbar-links a").removeClass("active");var o=t.route;0===o.indexOf("/location/")||"/register"==o||"/register-store"==o||"/store-login"==o||$(".navbar-link-"+t.file).addClass("active"),app.routerBase.isUserLoggedIn()?($(".navbar-link-logout").show(),$(".navbar-link-account").show(),$(".navbar-link-login").hide(),app.data.getStoreIdFromStorage()&&$(".navbar-link-dashboard").show()):($(".navbar-link-login").show(),$(".navbar-link-logout").hide(),$(".navbar-link-account").hide(),$(".navbar-link-dashboard").hide()),new app.controls.Typeahead(function(t,e){t&&e&&app.routerBase.loadPageForRoute("/location/"+e,"site")}),e.linkClicked=function(t,e){if("blog"==t.target.innerText.toLowerCase())return app.util.showToast(app.Strings.notWorkingYet),!1;if("account"==t.target.innerText.toLowerCase())return app.routerBase.loadPageForRoute("/account/"+app.data.getPersonIdFromStorage(),"site"),!1;if("dashboard"==t.target.innerText.toLowerCase()){var o=app.data.getStoreIdFromStorage();return window.location.href="/store-admin/"+o+"/dashboard",!1}return app.routerBase.loadPageForRoute(e,"site"),!1}}},app.site.resetPassword={init:function(){var t=this;this.resetPasswordToken=window.location.search,!this.resetPasswordToken||this.resetPasswordToken.length<30?app.util.showToast(app.Strings.invalidVerificationToken,4e3):(this.resetPasswordToken=this.resetPasswordToken.substr(3,this.resetPasswordToken.length),$("#form-reset-password").on("submit",function(){var e=validate.collectFormValues($("#form-reset-password")[0],{trim:!0});return e.token=t.resetPasswordToken,!!app.util.validateInputs(e,app.validationRules.resetPassword)&&(app.util.ajaxRequest({method:"POST",url:"/api/v1/reset-password",data:e},function(t){t||app.data.invalidateTokensAndGoToLogin()},!0),!1)}))}},app.site.store={init:function(t){var e=this;app.storeContent.init(),this.checkoutHeaderHeight=60,this.$checkout=$("#store-checkout"),this.$checkoutContent=$("#store-checkout-content"),this.$checkoutTable=$("#store-checkout-content-table"),this.$checkoutHide=$("#store-checkout-header-hide"),this.$checkoutShow=$("#store-checkout-header-show"),this.$checkoutDetails=$("#store-checkout-header-details");var o=localStorage.getItem("cht"),i=localStorage.getItem("cop");o||(o=screen.height/2-this.checkoutHeaderHeight,localStorage.setItem("cht",o)),i&&this.$checkoutContent.show(),this.$checkoutContent.css("height",o);var a=t.route.split("/");a=a[a.length-1],new app.controls.Resizer("vertical","#store-checkout-resize","#store-checkout-content",this.checkoutHeaderHeight,function(){}),app.data.getStoreData(a,function(t){console.log(t),t&&(t.id_store=app.storeContent.id_store,app.storeContent.addStoreDetailsDataToPage(a,t),app.storeContent.addMenuDataToPage(t),e.afterStoreDataLoaded())}),this.$checkoutShow.on("click",function(){e.showCheckout()}),this.$checkoutHide.on("click",function(){e.hideCheckout()})},afterStoreDataLoaded:function(){var t=this;this.updateCheckout(),$(".store-menu-list-item-option").on("click",function(e){t.addItemToCheckout(e.currentTarget.dataset.productOptionId,$(e.currentTarget).closest(".store-menu-list-item")[0].dataset.productId)})},showCheckout:function(){this.$checkoutContent.show(),this.$checkoutHide.show(),this.$checkoutShow.hide()},hideCheckout:function(){this.$checkoutContent.hide(),this.$checkoutHide.hide(),this.$checkoutShow.show()},addItemToCheckout:function(t,e){if(t&&e){var o=app.data.getCheckoutData();o.push({id_product:t,id_product_option:e,quantity:1,extras:[]}),app.data.setCheckoutData(o),this.updateCheckout(o)}else console.log("productId or productOptionId missing")},updateCheckout:function(t){if(t||(t=app.data.getCheckoutData()),this.$checkoutTable.empty(),0===t.length)return this.$checkout.hide(),app.data.setCheckoutData([]),void this.$checkoutDetails.text("");if(app.storeContent.storeData){for(var e=null,o=null,i=document.createDocumentFragment(),a=0;a<t.length;a++)if(e=app.storeContent.getProduct(t[a].id_product),o=app.storeContent.getProductOption(t[a].id_product_option),e)if(o)for(var n=0;n<20;n++)i.append(app.util.loadTemplate("#template-store-checkout-item",{name:e.name,nameOption:o.name,price:o.price,quantity:t[a].quantity,extras:t[a].extras,total:"$25.92"})[0]);else console.log("unable to find option",o,t[a]);else console.log("unable to find product",e,t[a]);this.$checkoutTable.append(i);var s=t.length+" Item"+(1===t.length?"":"s")+" in your Basket";this.$checkoutDetails.text(s),this.$checkout.show()}}},app.site.verifyAccount={init:function(){var t=this;this.verificationToken=window.location.search,!this.verificationToken||this.verificationToken.length<30?app.util.showToast(app.Strings.invalidVerificationToken,4e3):(this.verificationToken=this.verificationToken.substr(3,this.verificationToken.length),$("#form-verify-account").on("submit",function(){var e=validate.collectFormValues($("#form-verify-account")[0],{trim:!0});return e.verification_token=t.verificationToken,!!app.util.validateInputs(e,app.validationRules.verifyAccount)&&(app.util.ajaxRequest({method:"POST",url:"/api/v1/verify-account",data:e},function(t,e){t||(app.data.addJwtToStorage(e.data.jwt),app.data.addPersonIdToStorage(e.data.id_person),$("#form-verify-account").addClass("hidden"),$("#verify-account-success").removeClass("hidden"))},!0),!1)}),$("#verify-account-success-account").on("click",function(){var t=app.data.getPersonIdFromStorage();t?window.location.href="/account/"+t:app.data.invalidateTokensAndGoToLogin()}),$("#verify-account-success-home").on("click",function(){window.location.href="/"}))}},app.data={storeDataRequestNotAllowed:!1,storeData:{},getStoreData:function(t,e){"function"==typeof t&&(e=t,t=null);var o=this;if(this.storeDataRequestNotAllowed)return e(this.storeData);t=t||this.getStoreIdFromStorage();if(!app.util.validateInputs({id_store:t},app.validationRules.getStore))return!1;this.storeDataRequestNotAllowed=!0,setTimeout(function(){o.storeDataRequestNotAllowed=!1},2e3),app.util.ajaxRequest({method:"GET",url:"/api/v1/store?id_store="+t,cache:!0},function(t,i){if(!t)return i.data.hours=i.data.hours[0],o.storeData=i.data,e(o.storeData)})},isStoreOpen:function(t,e,o){if(!this.storeData||0===Object.keys(this.storeData).length)return null;var i={isDineinOpen:!1,isDeliveryOpen:!1},a=new Date,n=t||a.getHours()+":"+a.getMinutes(),s=moment(n,"HH:mm").add(o||0,"days"),r=e||app.util.getTodayName(),l=this.storeData.hours["hours_"+r+"_dinein_open"],p=this.storeData.hours["hours_"+r+"_dinein_close"],u=this.storeData.hours["hours_"+r+"_delivery_open"],c=this.storeData.hours["hours_"+r+"_delivery_close"];if("NULL"!==l&&"NULL"!==p){var d=moment(l,"HH:mm"),h=moment(p,"HH:mm");h.isBefore(d)&&h.add(1,"days"),(l===n||s.isBetween(d,h))&&(i.isDineinOpen=!0)}if("NULL"!==u&&"NULL"!==c){var m=moment(u,"HH:mm"),g=moment(c,"HH:mm");g.isBefore(m)&&g.add(1,"days"),(u===n||s.isBetween(m,g))&&(i.isDeliveryOpen=!0)}return i},getWhenStoreOpensOrClosesNext:function(t,e,o){if(!this.storeData||0===Object.keys(this.storeData).length)return null;var i=this.isStoreOpen(t,e,o);i.isDineinOpen},getCheckoutData:function(){var t=window.sessionStorage.getItem("cod");try{t=JSON.parse(t)}catch(t){}return t||(t=[]),t},setCheckoutData:function(t){window.sessionStorage.setItem("cod",JSON.stringify(t))},addJwtToStorage:function(t){localStorage.setItem("jwt",t)},getJwtFromStorage:function(){var t=localStorage.getItem("jwt");return app.util.checkIfString(t)?t:null},addPersonIdToStorage:function(t){localStorage.setItem("pid",t)},getPersonIdFromStorage:function(){var t=Number(localStorage.getItem("pid"));return app.util.checkIfPositiveInteger(t)?t:null},addStoreIdToStorage:function(t){localStorage.setItem("sid",t)},getStoreIdFromStorage:function(){var t=Number(localStorage.getItem("sid"));return app.util.checkIfPositiveInteger(t)?t:null},invalidateTokensAndGoToLogin:function(){localStorage.removeItem("jwt"),localStorage.removeItem("pid"),localStorage.removeItem("sid"),window.location.href="/login"}},app.dialogs.businessHours={init:function(){var t=this;this.$hoursLeft=$("#dialog-store-hours-left"),this.$hoursRight=$("#dialog-store-hours-right"),$("#dialog-store-hours-close").on("click",function(){t.hide()})},update:function(t){if(t){for(var e=app.util.days,o=app.util.getTodayName(),i=document.createDocumentFragment(),a=0;a<e.length;a++)i.appendChild($(this.getHoursRow(t,e[a],!0,o===e[a]))[0]);this.$hoursLeft.append(i),i=document.createDocumentFragment();for(a=0;a<e.length;a++)i.appendChild($(this.getHoursRow(t,e[a],!1,o===e[a]))[0]);this.$hoursRight.append(i)}},getHoursRow:function(t,e,o,i){var a="hours_"+e.toLowerCase()+"_"+(o?"dinein":"delivery"),n=a+"_open",s=a+"_close",r=t[n];r="null"===r.toLowerCase()?"closed":t[n]+" to "+t[s];var l="";return i&&(l="today"),"<li class='"+l+"'><span>"+e+"</span> "+r+"</li>"},show:function(){app.dialogs.show("#dialog-store-hours")},hide:function(){app.dialogs.hide()}},app.dialogs.description={init:function(){var t=this;$("#dialog-store-description-close").on("click",function(){t.hide()})},update:function(t,e){$("#dialog-store-description-heading").text(t),$("#dialog-store-description-text").text(e)},show:function(){app.dialogs.show("#dialog-store-description")},hide:function(){app.dialogs.hide()}},app.dialogs.init=function(){Object.keys(this).forEach(function(t){app.dialogs[t].init&&app.dialogs[t].init()}),this.$dialogContainer=$("#dialog-container"),this.$dialogs=this.$dialogContainer.children(),this.$dialogContainer.on("click",function(){})},app.dialogs.show=function(t){this.$dialogContainer.show(),$(t).show()},app.dialogs.hide=function(){this.$dialogs.hide(),this.$dialogContainer.hide()},app.dialogs.reviews={init:function(){var t=this;$("#dialog-store-reviews-add-review").on("click",function(){app.util.showToast("not working yet")}),$("#dialog-store-reviews-close").on("click",function(){t.hide()})},update:function(t){},show:function(){app.dialogs.show("#dialog-store-reviews")},hide:function(){app.dialogs.hide()}},app.routerBase={firstLoad:!0,lastLoadedSection:"",isLoading:!1,init:function(){document.addEventListener("deviceready",function(){app.cordova.init()},!1)},loadPageForRoute:function(t,e,o){var i=this;if(!this.isLoading&&(window.location.pathname!==t||o)){this.isLoading=!0,this.lastLoadedSection=e,$(window).off(),$(document).off(),window.onpopstate=function(){console.log("on popstate "+window.location.pathname),i.loadPageForRoute(window.location.pathname,i.lastLoadedSection,!0)};var a=t||window.location.pathname,n={route:a};if(app.util.isCordova()&&"/index-cordova"==(a=a.substring(a.lastIndexOf("/"),a.length-5))&&(a="/"),n.normalizedRoute=app[e].normalizeRoute(a).route,n.section=e,-1!==app[e].routesList.indexOf(n.normalizedRoute))return n.html=app[e].htmlFiles[n.normalizedRoute],$.extend(n,app[e].routes[n.normalizedRoute]),$("#page-container").empty(),$("#page-container").append(n.html),$("html, body").animate({scrollTop:0},200),app[e].routes[n.normalizedRoute].initFunction(n),app[e].onPageChanged(n),$("body").css("visibility","visible"),this.firstLoad||o||n.route!=window.location.pathname&&window.history.pushState(null,n.route,n.route),this.firstLoad=!1,this.isLoading=!1,n;app.data.invalidateTokensAndGoToLogin()}},logUserOut:function(){app.util.ajaxRequest({method:"GET",url:"/api/v1/logout",auth:!0},function(){app.data.invalidateTokensAndGoToLogin()})},isUserLoggedIn:function(){var t=app.data.getJwtFromStorage();return t&&t.length>30}},app.storeContent={init:function(){this.$storeInfo=$("#store-info"),this.$logo=$(".store-info-image"),this.$description=$("#store-info-description"),this.$logoEmpty=$(".store-info-image-empty"),this.$logoLoading=$(".store-info-image-loading"),this.$descriptionButton=$("#store-info-button-description"),this.$hoursButton=$("#store-info-button-hours"),this.$reviewsButton=$("#store-info-button-reviews"),this.$menuList=$("#store-menu-list"),this.$logoEmpty.hide(),this.$logoLoading.show(),this.$descriptionButton.on("click",function(){app.dialogs.description.show()}),this.$hoursButton.on("click",function(){app.dialogs.businessHours.show()}),this.$reviewsButton.on("click",function(){app.dialogs.reviews.show()})},resizeDescription:function(){this.$description[0].scrollHeight>this.$description.innerHeight()?this.$descriptionButton.show():this.$descriptionButton.hide()},addStoreDetailsDataToPage:function(t,e){e||(e=t,t=null);var o=this;if(t=t||app.data.getStoreIdFromStorage()){var i=new Image;i.src="/res/storelogos/store"+t+".jpg?"+Date.now(),i.onload=function(){o.$logo.attr("src",i.src),o.$logoEmpty.hide(),o.$logoLoading.hide()},i.onerror=function(){o.$logoLoading.hide(),o.$logoEmpty.show()};var a=e.address[0];a=a.street_address+" "+a.suburb+" "+a.postcode,$("#store-header-name").text(e.name),this.$description.text(e.description),$("#store-info-address").text(a),$("#store-info-phone-number").text(e.phone_number),$("#store-info-email").text(e.email),$("#store-disclaimer").text(e.disclaimer),$("#store-info-review-count").text("( "+e.review_count+" )"),$("#store-info-hours-is-open").text(),$("#store-info-hours-opens-at").text(),app.controls.RatingControls.setValue("#store-info-rating-control",Math.round(e.rating)),app.dialogs.description.update(e.name,e.description),app.dialogs.businessHours.update(e.hours),app.dialogs.reviews.update(e),$(window).on("resize",function(){o.resizeDescription()})}},addMenuDataToPage:function(t){var e=0,o=0,i=null,a=null,n=document.createDocumentFragment();if(t.products){for(e=0;e<t.products.length;e++){var s=(a=t.products[e]).options[0].price;for(o=0;o<a.options.length;o++)a.options[o].price<s&&(s=a.options[o].price);a.lowestOptionPrice=s,a.gluten_free&&(a.class1="label-gluten-free"),a.vegetarian&&(a.class2="label-vegetarian"),a.delivery_available||(a.class3="label-takeaway");var r=(i=app.util.loadTemplate("#template-store-menu-item",a,a.id_product,"data-product-id")).find(".store-menu-list-item-options > .store-menu-list-item-content").last(),l=null,p=a.options.length;for(o=0;o<a.options.length;o++)l=app.util.loadTemplate("#template-store-menu-option",a.options[o],a.options[o].id_product_option,"data-product-option-id"),screen.width>1e3&&l.css({width:100/p+"%"}),r.append(l[0]);n.append(i[0])}for(e=0;e<t.product_headings.length;e++){var u=t.product_headings[e],c=$(n).find(".store-menu-list-item[data-product-id='"+u.above_product_id+"']");c&&(i=app.util.loadTemplate("#template-store-menu-heading",u,u.id_product_heading,"data-heading-id")).insertBefore(c)}this.$menuList.append(n),$(".store-menu-list-item-details").on("click",function(){$(".store-menu-list-item").removeClass("options-active"),$(this).parent().addClass("options-active")}),$(".store-menu-list-item-options-cancel").on("click",function(){$(this).parent().parent().removeClass("options-active")}),new app.controls.CategoryScroller(t.product_headings)}else this.$menuList.append(app.Strings.noProducts)},getProduct:function(t){if(!t)return null;for(var e=0;e<this.storeData.products.length;e++)if(this.storeData.products[e].id_product==t)return this.storeData.products[e];return null},getProductOption:function(t){if(!t)return null;for(var e=null,o=0;o<this.storeData.products.length;o++)if(e=this.storeData.products[o].options)for(var i=0;i<e.length;i++)if(e[i].id_product_option==t)return e[i];return null}},void 0===app)&&((app={}).Strings=app.Strings={});app.util={checkIfObject:function(t){return!!t&&(t&&"object"==typeof t&&t.constructor===Object)},checkIfString:function(t){return"string"==typeof t||t instanceof String},checkIfDate:function(t){return!!t&&(t instanceof Date&&isFinite(t))},checkIfPositiveInteger:function(t,e){var o=parseInt(t);return!isNaN(o)&&(o=Number(t),!!Number.isInteger(o)&&(e?o>=0:o>0))},validateInputs:function(t,e){if(!t||!this.checkIfObject(t)||0===Object.keys(t).length)return console.log("validation inputs missing"),!1;if(!e)return console.log("validate rule undefined"),!1;var o=validate(t,e,{format:"flat"});return!(o&&o.length>0)||(this.showToast(o[0]),!1)},days:function(){return[app.Strings.daysMon,app.Strings.daysTue,app.Strings.daysWed,app.Strings.daysThu,app.Strings.daysFri,app.Strings.daysSat,app.Strings.daysSun]},getTodayIndex:function(t){var e=t?t.getDay():(new Date).getDay();return-1==(e-=1)&&(e=6),e},getTodayName:function(t){return this.days()[this.getTodayIndex(t)]},getTomorrowName:function(t){var e=this.getTodayIndex(t)+1;return e>6&&(e=0),this.days()[e]},toTitleCase:function(t){return t?t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}):""},setupTemplateFormatters:function(){$.addTemplateFormatter({lowestOptionPriceFormatter:function(t){return app.Strings.fromDollar+t},priceFormatter:function(t){return app.Strings.fromDollar+t.toFixed(2)},categoryArrayFormatter:function(t){return t.join(", ")},phoneNumberFormatter:function(t){return app.Strings.phone+" "+t},deliveryFormatter:function(t){return app.Strings.delivery+" "+t},minOrderFormatter:function(t){return app.Strings.minOrder+" "+t}})},isCordova:function(){return"true"==$("#is-cordova").val()},showToast:function(t,e,o){var i=$("#toasts"),a=$("<p class='"+(o||"")+"'>"+t+"</p>");i.children().length>=5&&i.children().first().animate({opacity:0,bottom:-50},100,function(){$(this).remove()}),i.append(a[0]),i.show(),a.animate({opacity:1,bottom:0},100),setTimeout(function(){i.children().first().animate({opacity:0,bottom:-50},100,function(){$(this).remove()}),0===i.children().length&&i.hide().empty()},e||2e3)},showLoadingScreen:function(){$("#loading-screen").show()},hideLoadingScreen:function(){$("#loading-screen").hide()},loadTemplate:function(t,e,o,i){var a=$("<div></div>").loadTemplate($(t),e,{isFile:!1});return a=a.children().first().unwrap(),i&&a.attr(i,o),a},checkToken:function(t){var e=this,o=app.data.getJwtFromStorage();if(!app.util.validateInputs(o,app.validationRules._people_jwt))return app.data.invalidateTokensAndGoToLogin(),t(app.Strings.invalidToken);this.ajaxRequest({method:"POST",url:"/api/v1/check-token",auth:!0},function(o,i){return o?(console.log(o),e.invalidateCredentials(),t(app.Strings.invalidToken)):(app.data.addJwtToStorage(i.data.jwt),app.data.addPersonIdToStorage(i.data.id_person),i.data.id_store&&i.data.id_store>0&&app.data.addStoreIdToStorage(i.data.id_store),t(null))})},preloadImages:function(t,e){for(var o=[],i=0,a=0;a<e.length;a++)o.push(new Image),o[a].src=t+e[a],o[a].onload=function(){++i===o.length&&(o=null)}},uploadImage:function(t,e){if(t&&t.length>0){if(t[0].size>25e4)return void this.showToast(app.Strings.imageFileTooBig);var o=new FormData;o.append("logo",t[0]),o.append("id_store",app.data.getStoreIdFromStorage()),this.ajaxRequest({method:"POST",url:"/api/v1/store-update-logo",auth:!0,isImage:!0,data:o},function(t,o){return!t&&o&&o.data&&o.data.url?e(null,o.data.url):(console.log(t),e(app.Strings.errorUploadingImage))})}else this.showToast(app.Strings.invalidImage)},ajaxRequest:function(t,e){var o=this,i="application/x-www-form-urlencoded; charser=UTF-8";t.isImage&&(i=!1);var a={method:t.method,url:t.url,data:t.data,cache:t.cache||!1,processData:!t.isImage,contentType:i,beforeSend:function(o){if(t.auth){var i=app.data.getJwtFromStorage();if(!app.util.validateInputs(i,app.validationRules._people_jwt))return o.abort(),app.data.invalidateTokensAndGoToLogin(),e(app.Strings.invalidToken);o.setRequestHeader("authorization","Bearer "+i)}},success:function(t){return e(null,t)},error:function(t){return console.log(t),t&&(t.responseJSON&&t.responseJSON.err?o.showToast(t.responseJSON.err,4e3):o.showToast(app.Strings.serverError,4e3)),e(t)}};t.dataType&&(a.dataType=t.dataType),$.ajax(a)}},app.validationRules={_sequence_id:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0}},_sequence_id_optional:{numericality:{onlyInteger:!0,greaterThan:0}},_email:{presence:!0,email:!0,length:{minimum:3,maximum:256}},_email_optional:{email:!0,length:{minimum:3,maximum:256}},_phone_number:{presence:!0,length:{minimum:3,maximum:32}},_phone_number_optional:{length:{minimum:3,maximum:32}},_url_link:{presence:!0,length:{maximum:256}},_url_link_optional:{length:{maximum:256}},_bit:{presence:!0,numericality:{onlyInteger:!0,greaterThanOrEqualTo:0,lessThanOrEqualTo:1}},_bit_optional:{numericality:{onlyInteger:!0,greaterThanOrEqualTo:0,lessThanOrEqualTo:1}},_notes_optional:{length:{maximum:256}},_price:{presence:!0,numericality:{greaterThanOrEqualTo:0}},_price_optional:{numericality:{greaterThanOrEqualTo:0}},_quantity:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0}},_latitude_optional:{numericality:{greaterThanOrEqualTo:0}},_longitude_optional:{numericality:{greaterThanOrEqualTo:0}},_addresses_street_address:{presence:!0,length:{maximum:256}},_people_first_name:{presence:!0,length:{minimum:2,maximum:45}},_people_first_name_optional:{length:{minimum:2,maximum:45}},_people_last_name:{presence:!0,length:{minimum:2,maximum:45}},_people_last_name_optional:{length:{minimum:2,maximum:45}},_people_password:{presence:!0,length:{minimum:3,maximum:64}},_people_reset_password_token:{presence:!0,length:64},_people_reset_password_token_optional:{presence:!0,length:64},_people_jwt:{presence:!0,length:{minimum:30,maximum:512}},_people_jwt_optional:{length:{minimum:30,maximum:512}},_people_verification_token:{presence:!0,length:64},_postcodes_postcode:{presence:!0,length:{minimum:1,maximum:6}},_postcodes_suburb:{presence:!0,length:{minimum:1,maximum:64}},_postcodes_state:{presence:!0,length:{minimum:1,maximum:32}},_reviews_title:{presence:!0,length:{minimum:2,maximum:128}},_reviews_review_optional:{length:{maximum:512}},_reviews_rating:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0,lessThan:6}},_stores_name:{presence:!0,length:{maximum:512}},_stores_description_optional:{length:{maximum:1024}},_stores_abn:{presence:!0,length:{minimum:10,maximum:32}},_stores_bank_name:{presence:!0,length:{minimum:2,maximum:128}},_stores_bank_bsb:{presence:!0,length:{minimum:6,maximum:16}},_stores_bank_account_name:{presence:!0,length:{minimum:2,maximum:128}},_stores_bank_account_number:{presence:!0,length:{minimum:2,maximum:32}},_stores_hours:{length:{maximum:5}},_product_extras_name:{presence:!0,length:{maximum:32}},_product_options_name:{presence:!0,length:{maximum:32}},_products_name:{presence:!0,length:{maximum:64}},_products_description_optional:{length:{maximum:256}},_order_products_customer_notes_optional:{length:{maximum:256}},_orders_notes_optional:{length:{maximum:256}},_orders_expiry:{presence:!0,datetime:!0},_transactions_commission:{presence:!0,numericality:{greaterThanOrEqualTo:0,lessThanOrEqualTo:1e3}},_transactions_processing_fee:{presence:!0,numericality:{greaterThanOrEqualTo:0,lessThanOrEqualTo:1e3}}},app.validationRules.login={email:app.validationRules._email,password:app.validationRules._people_password},app.validationRules.createUser={first_name:app.validationRules._people_first_name,last_name:app.validationRules._people_last_name,email:app.validationRules._email,password:app.validationRules._people_password,confirmPassword:{equality:"password"}},app.validationRules.storeApplication={name:{presence:!0,length:{maximum:128}},email:app.validationRules._email,message:{length:{maximum:256}}},app.validationRules.forgotPassword={email:app.validationRules._email},app.validationRules.verifyAccount={email:app.validationRules._email,password:app.validationRules._people_password,verification_token:app.validationRules._people_verification_token},app.validationRules.resetPassword={email:app.validationRules._people_email,password:app.validationRules._people_password,confirmPassword:{equality:"password"},reset_password_token:app.validationRules._people_reset_password_token},app.validationRules.createStore={postcode:app.validationRules._postcodes_postcode,suburb:app.validationRules._postcodes_suburb,street_address:app.validationRules._addresses_street_address,first_name:app.validationRules._people_first_name,last_name:app.validationRules._people_last_name,phone_number_user:app.validationRules._phone_number,email_user:app.validationRules._email,password:app.validationRules._people_password,name:app.validationRules._stores_name,abn:app.validationRules._stores_abn,internal_notes_store:app.validationRules._notes_optional},app.validationRules.deleteStore={id_store:app.validationRules._sequence_id},app.validationRules.updateStoreDetails={description:app.validationRules._stores_description_optional,street_address:app.validationRules._addresses_street_address,postcode:app.validationRules._postcodes_postcode,suburb:app.validationRules._postcodes_suburb,phone_number:app.validationRules._phone_number,email:app.validationRules._phone_email,hours_mon_dinein_open:app.validationRules._stores_hours,hours_tue_dinein_open:app.validationRules._stores_hours,hours_wed_dinein_open:app.validationRules._stores_hours,hours_thu_dinein_open:app.validationRules._stores_hours,hours_fri_dinein_open:app.validationRules._stores_hours,hours_sat_dinein_open:app.validationRules._stores_hours,hours_sun_dinein_open:app.validationRules._stores_hours,hours_mon_dinein_close:app.validationRules._stores_hours,hours_tue_dinein_close:app.validationRules._stores_hours,hours_wed_dinein_close:app.validationRules._stores_hours,hours_thu_dinein_close:app.validationRules._stores_hours,hours_fri_dinein_close:app.validationRules._stores_hours,hours_sat_dinein_close:app.validationRules._stores_hours,hours_sun_dinein_close:app.validationRules._stores_hours,hours_mon_delivery_open:app.validationRules._stores_hours,hours_tue_delivery_open:app.validationRules._stores_hours,hours_wed_delivery_open:app.validationRules._stores_hours,hours_thu_delivery_open:app.validationRules._stores_hours,hours_fri_delivery_open:app.validationRules._stores_hours,hours_sat_delivery_open:app.validationRules._stores_hours,hours_sun_delivery_open:app.validationRules._stores_hours,hours_mon_delivery_close:app.validationRules._stores_hours,hours_tue_delivery_close:app.validationRules._stores_hours,hours_wed_delivery_close:app.validationRules._stores_hours,hours_thu_delivery_close:app.validationRules._stores_hours,hours_fri_delivery_close:app.validationRules._stores_hours,hours_sat_delivery_close:app.validationRules._stores_hours,hours_sun_delivery_close:app.validationRules._stores_hours},app.validationRules.getStore={id_store:app.validationRules._sequence_id},app.validationRules.validateHours=function(t){if(!t||0===Object.keys(t).length)return"Data missing";for(var e=null,o=null,i=Object.keys(t),a=0;a<i.length;a++)if(0===i[a].indexOf("hours_"))if(t[i[a]]){if(5!==t[i[a]].length||!t[i[a]].match(/\d{2}:\d{2}/))return o=(e=i[a].split("_"))[1]+" "+e[2]+" "+e[3],"Error in Hours "+(o=app.util.toTitleCase(o))+".  Must be HH:MM"}else{var n="open"===(e=i[a].split("_"))[3]?"close":"open";if(o=e[1]+" "+e[2]+" "+e[3],o=app.util.toTitleCase(o),t[e=e[0]+"_"+e[1]+"_"+e[2]+"_"+n])return"Error in Hours "+o+".  Open and Close must be both times or both closed"}return null},app.controls.CategoryScroller=function(t){var e=$("html"),o=".category-scroller-list",i=$(".category-scroller-container"),a=$(".category-scroller"),n=$(o),s=[],r=$(".store-menu-list-item.heading"),l=0,p=[];function u(){p=[],r.each(function(){p.push(this.getBoundingClientRect().top+e.scrollTop())})}function c(){var t=e.scrollTop();for(l=p.length-1;l>=0;l--)if(t>p[l]-110){s.removeClass("active"),$(s[l]).addClass("active");break}}var d=null,h=document.createDocumentFragment();for(l=0;l<t.length;l++)d=$("<li class='store-menu-nav-list-item'>"+t[l].title+"</li>"),h.append(d[0]);n.append(h),new app.controls.HorizontalScroller(o,function(t){var o=$(".store-menu-list-item.heading:contains('"+t.innerText+"')"),i=(screen.width,100);o[0]&&$("html").animate({scrollTop:o[0].getBoundingClientRect().top+e.scrollTop()-i},500)}),$(window).on("resize",function(){u(),c()}),$(window).on("scroll",function(){s.length&&(i[0].getBoundingClientRect().top<20?a.addClass("floating"):a.removeClass("floating"),c())}),s=$(".store-menu-nav-list-item"),u()},app.controls.Navbar=function(){var t=this;$(".navbar a").on("click",function(e){if("logout"==this.innerText.toLowerCase())return app.routerBase.logUserOut(),!1;var o=this.href.replace(window.location.origin,"");return t.linkClicked(e,o),!1}),$(".navbar-links-popup-button").on("click",function(){$(".navbar-links-popup").animate({right:0},200)}),$(".navbar-links-popup-close").on("click",function(){$(".navbar-links-popup").animate({right:-250},200)}),$(".navbar-icon").on("click",function(t){t.ctrlKey?window.location.href="/admin-login":window.location.href="/location/Balmoral-4171"})},app.controls.Navbar.prototype.linkClicked=function(){},app.controls.RatingControls={setValue:function(t,e){for(var o=$(t),i=0;i<e;i++)o.children().eq(i).addClass("active")},getValue:function(t){return $(t+" .rating-control-star.active").length},updateRatingControls:function(t){for(var e=0;e<t.length;e++)if(t[e].id_review)for(var o=$(".rating-control-stars.user[data-id='"+t[e].id_review+"']"),i=0;i<t[e].rating;i++)o.children().eq(i).addClass("active")},recreateRatingControlEvents:function(){$(".rating-control-star").off(),$(".rating-control-star").unbind();var t=!1;$(".rating-control-star").on("click",function(){$(this).hasClass("active")||$(this).siblings().hasClass("active")||(t=!0),console.log(t),$(this).removeClass("active"),$(this).siblings().removeClass("active"),$(this).addClass("active"),$(this).prevAll().addClass("active")})}},app.controls.Resizer=function(t,e,o,i,a){var n=$(e),s=$(o),r=0,l=0,p=!1,u=0;n.on("mousedown",function(t){p=!0,r=t.clientX,l=t.clientY,console.log(r,l)}),$(window).on("mousemove",function(t){t.preventDefault(),p&&(s.show(),u=window.innerHeight-t.clientY-i,s.height(u),a&&a())}),$(window).on("mouseup",function(){p=!1})},app.controls.HorizontalScroller=function(t,e){var o=this,i=!1;this.startMouseX=0;var a=0,n=!1;this.diff=0,this.scrollBlurTolerance=5,this.$scrollerList=$(t),this.$scrollBlurLeft=this.$scrollerList.prev(),this.$scrollBlurRight=this.$scrollerList.next(),this.$scrollerList.on("mousedown",function(t){i=!0,n=!1,o.startMouseX=t.clientX,a=$(this).scrollLeft()}),$(window).on("mousemove",function(t){i&&(t.stopPropagation(),o.$scrollerList.scrollLeft(a-(t.clientX-o.startMouseX)),o.isInsideTolerance(t.clientX)||(n=!0))}),$(window).on("mouseup",function(){i=!1}),this.$scrollerList.on("mouseup",function(t){if(!n)return e(t.target);n=!1}),this.$scrollerList.on("scroll",function(){o.updateScrollBlurs()}),$(window).on("resize",function(){o.updateScrollBlurs()}),this.updateScrollBlurs()},app.controls.HorizontalScroller.prototype.updateScrollBlurs=function(){this.$scrollerList[0].scrollLeft>this.scrollBlurTolerance?this.$scrollBlurLeft.show():this.$scrollBlurLeft.hide(),this.$scrollerList[0].scrollLeft+this.$scrollerList[0].clientWidth<this.$scrollerList[0].scrollWidth-this.scrollBlurTolerance?this.$scrollBlurRight.show():this.$scrollBlurRight.hide()},app.controls.HorizontalScroller.prototype.isInsideTolerance=function(t){return this.diff=t-this.startMouseX,this.diff>=-this.scrollBlurTolerance&&this.diff<=this.scrollBlurTolerance},app.controls.Typeahead=function(t){var e=this;this.$typeaheadInput=$("#typeahead-suburb-search"),this.$typeaheadList=$("#typeahead-suburb-list");var o=null;function i(o){var i={suburb:$(o).find(".typeahead-item-suburb").text(),postcode:$(o).find(".typeahead-item-postcode").text()};if(e.$typeaheadList.hide(),e.$typeaheadInput.attr("data-suburb",""),e.$typeaheadInput.attr("data-postcode",""),!i.suburb||!i.postcode)return t(null);e.setValue(i.postcode,i.suburb);var a=encodeURIComponent(i.suburb+"-"+i.postcode);return t(i,a)}this.baseUrl="/api/v1/location?q=",this.$typeaheadList.on("click",function(t){i(t.target)}),this.$typeaheadInput.on("focus",function(){this.setSelectionRange(0,this.value.length)}),this.$typeaheadInput.on("blur",function(){var t=e.getValue();t.suburb&&t.postcode?e.setValue(t.postcode,t.suburb):(e.$typeaheadInput.attr("data-suburb",""),e.$typeaheadInput.attr("data-postcode",""),e.$typeaheadInput.val(""))}),this.$typeaheadInput.on("keyup",function(t){var a=0,n=[],s=$(this).val().toLowerCase();if(27!=t.which)if(13!=t.which)if(38!=t.which)if(40!=t.which)clearTimeout(o),o=setTimeout(function(){if(s){var t=e.baseUrl+s;app.util.ajaxRequest({method:"GET",url:t},function(t,o){if(!t){var i=[];for(a=0;a<o.data.length;a++)i.push("<li class='typeahead-item'><label class='typeahead-item-postcode'>"+o.data[a].postcode+"</label><span>♔</span><label class='typeahead-item-suburb'>"+app.util.toTitleCase(o.data[a].suburb)+"</label></li>");e.$typeaheadList.empty(),i.length>0?(e.$typeaheadList.append(i.join("")),e.$typeaheadList.show()):(e.$typeaheadList.show(),e.$typeaheadList.append("<li class='typeahead-item'>"+app.Strings.noResults+"</li>"))}})}else e.$typeaheadList.hide()},500);else for(n=$(".typeahead-item"),a=n.length-1;a>=0;a--){if($(n[a]).hasClass("active")){$(n[a]).removeClass("active"),$(n[a]).next().addClass("active");break}0==a&&$(n[0]).addClass("active")}else for(n=$(".typeahead-item"),a=0;a<n.length;a++){if($(n[a]).hasClass("active")){$(n[a]).removeClass("active"),$(n[a]).prev().addClass("active");break}a==n.length-1&&$(n[n.length-1]).addClass("active")}else{var r=$(".typeahead-item.active");r.length>0&&i(r[0])}}),$(window).on("mousedown",function(t){"typeahead-item"!=t.target.className&&e.$typeaheadList.hide()}),$(window).on("keydown",function(t){27==t.which&&e.$typeaheadList.hide()})},app.controls.Typeahead.prototype.setValue=function(t,e){this.$typeaheadInput.val(t+" - "+e),this.$typeaheadInput.attr("data-suburb",e),this.$typeaheadInput.attr("data-postcode",t)},app.controls.Typeahead.prototype.getValue=function(){return{suburb:this.$typeaheadInput.attr("data-suburb"),postcode:this.$typeaheadInput.attr("data-postcode")}};