"use strict";var app;((app=app||{}).controls=app.controls||{},app.dialogs=app.dialogs||{},app.sysadmin={htmlFiles:{},init:function(e){this.htmlFiles=e,app.dialogs.init(),app.routerBase.init(),app.routerBase.loadPageForRoute(null,"sysadmin")},onPageChanged:function(){$("#navbar-link-logout").on("click",function(){app.routerBase.logUserOut()})},normalizeRoute:function(e){return{route:e,match:!0}},routes:{"/sysadmin/create-store":{file:"create-store",initFunction:function(e){document.title="SysAdmin - Create Store",app.sysadmin.createStore.init(e)}},"/sysadmin/edit-store":{file:"edit-store",initFunction:function(e){document.title="SysAdmin - Edit Store",app.sysadmin.editStore.init(e)}},"/sysadmin/database":{file:"database",initFunction:function(e){document.title="SysAdmin - Database",app.sysadmin.database.init(e)}}}},app.sysadmin.routesList=Object.keys(app.sysadmin.routes),app.sysadmin.createStore={init:function(){}},app.sysadmin.database={init:function(){}},app.sysadmin.editStore={init:function(){}},app.data={storeDataRequestNotAllowed:!1,storeData:{},getStoreData:function(e,t){"function"==typeof e&&(t=e,e=null);var o=this;if(this.storeDataRequestNotAllowed)return t(this.storeData);e=e||this.getStoreIdFromStorage();if(!app.util.validateInputs({id_store:e},app.validationRules.getStore))return!1;this.storeDataRequestNotAllowed=!0,setTimeout(function(){o.storeDataRequestNotAllowed=!1},2e3),app.util.ajaxRequest({method:"GET",url:"/api/v1/store?id_store="+e,cache:!0},function(e,a){if(!e)return a.data.hours=a.data.hours[0],o.storeData=a.data,t(o.storeData)})},isStoreOpen:function(e,t,o){if(!this.storeData||0===Object.keys(this.storeData).length)return null;var a={isDineinOpen:!1,isDeliveryOpen:!1},i=new Date,n=e||i.getHours()+":"+i.getMinutes(),s=moment(n,"HH:mm").add(o||0,"days"),r=t||app.util.getTodayName(),l=this.storeData.hours["hours_"+r+"_dinein_open"],p=this.storeData.hours["hours_"+r+"_dinein_close"],u=this.storeData.hours["hours_"+r+"_delivery_open"],d=this.storeData.hours["hours_"+r+"_delivery_close"];if("NULL"!==l&&"NULL"!==p){var c=moment(l,"HH:mm"),h=moment(p,"HH:mm");h.isBefore(c)&&h.add(1,"days"),(l===n||s.isBetween(c,h))&&(a.isDineinOpen=!0)}if("NULL"!==u&&"NULL"!==d){var m=moment(u,"HH:mm"),_=moment(d,"HH:mm");_.isBefore(m)&&_.add(1,"days"),(u===n||s.isBetween(m,_))&&(a.isDeliveryOpen=!0)}return a},getWhenStoreOpensOrClosesNext:function(e,t,o){if(!this.storeData||0===Object.keys(this.storeData).length)return null;var a=this.isStoreOpen(e,t,o);a.isDineinOpen},getCheckoutData:function(){var e=window.sessionStorage.getItem("cod");try{e=JSON.parse(e)}catch(e){}return e||(e=[]),e},setCheckoutData:function(e){window.sessionStorage.setItem("cod",JSON.stringify(e))},addJwtToStorage:function(e){localStorage.setItem("jwt",e)},getJwtFromStorage:function(){var e=localStorage.getItem("jwt");return app.util.checkIfString(e)?e:null},addPersonIdToStorage:function(e){localStorage.setItem("pid",e)},getPersonIdFromStorage:function(){var e=Number(localStorage.getItem("pid"));return app.util.checkIfPositiveInteger(e)?e:null},addStoreIdToStorage:function(e){localStorage.setItem("sid",e)},getStoreIdFromStorage:function(){var e=Number(localStorage.getItem("sid"));return app.util.checkIfPositiveInteger(e)?e:null},invalidateTokensAndGoToLogin:function(){localStorage.removeItem("jwt"),localStorage.removeItem("pid"),localStorage.removeItem("sid"),window.location.href="/login"}},app.dialogs.businessHours={init:function(){var e=this;this.$hoursLeft=$("#dialog-store-hours-left"),this.$hoursRight=$("#dialog-store-hours-right"),$("#dialog-store-hours-close").on("click",function(){e.hide()})},update:function(e){if(e){for(var t=app.util.days,o=app.util.getTodayName(),a=document.createDocumentFragment(),i=0;i<t.length;i++)a.appendChild($(this.getHoursRow(e,t[i],!0,o===t[i]))[0]);this.$hoursLeft.append(a),a=document.createDocumentFragment();for(i=0;i<t.length;i++)a.appendChild($(this.getHoursRow(e,t[i],!1,o===t[i]))[0]);this.$hoursRight.append(a)}},getHoursRow:function(e,t,o,a){var i="hours_"+t.toLowerCase()+"_"+(o?"dinein":"delivery"),n=i+"_open",s=i+"_close",r=e[n];r="null"===r.toLowerCase()?"closed":e[n]+" to "+e[s];var l="";return a&&(l="today"),"<li class='"+l+"'><span>"+t+"</span> "+r+"</li>"},show:function(){app.dialogs.show("#dialog-store-hours")},hide:function(){app.dialogs.hide()}},app.dialogs.description={init:function(){var e=this;$("#dialog-store-description-close").on("click",function(){e.hide()})},update:function(e,t){$("#dialog-store-description-heading").text(e),$("#dialog-store-description-text").text(t)},show:function(){app.dialogs.show("#dialog-store-description")},hide:function(){app.dialogs.hide()}},app.dialogs.init=function(){Object.keys(this).forEach(function(e){app.dialogs[e].init&&app.dialogs[e].init()}),this.$dialogContainer=$("#dialog-container"),this.$dialogs=this.$dialogContainer.children(),this.$dialogContainer.on("click",function(){})},app.dialogs.show=function(e){this.$dialogContainer.show(),$(e).show()},app.dialogs.hide=function(){this.$dialogs.hide(),this.$dialogContainer.hide()},app.dialogs.reviews={init:function(){var e=this;$("#dialog-store-reviews-add-review").on("click",function(){app.util.showToast("not working yet")}),$("#dialog-store-reviews-close").on("click",function(){e.hide()})},update:function(e){},show:function(){app.dialogs.show("#dialog-store-reviews")},hide:function(){app.dialogs.hide()}},app.routerBase={firstLoad:!0,lastLoadedSection:"",isLoading:!1,init:function(){document.addEventListener("deviceready",function(){app.cordova.init()},!1)},loadPageForRoute:function(e,t,o){var a=this;if(!this.isLoading&&(window.location.pathname!==e||o)){this.isLoading=!0,this.lastLoadedSection=t,$(window).off(),$(document).off(),window.onpopstate=function(){console.log("on popstate "+window.location.pathname),a.loadPageForRoute(window.location.pathname,a.lastLoadedSection,!0)};var i=e||window.location.pathname,n={route:i};if(app.util.isCordova()&&"/index-cordova"==(i=i.substring(i.lastIndexOf("/"),i.length-5))&&(i="/"),n.normalizedRoute=app[t].normalizeRoute(i).route,n.section=t,-1!==app[t].routesList.indexOf(n.normalizedRoute))return n.html=app[t].htmlFiles[n.normalizedRoute],$.extend(n,app[t].routes[n.normalizedRoute]),$("#page-container").empty(),$("#page-container").append(n.html),$("html, body").animate({scrollTop:0},200),app[t].routes[n.normalizedRoute].initFunction(n),app[t].onPageChanged(n),$("body").css("visibility","visible"),this.firstLoad||o||n.route!=window.location.pathname&&window.history.pushState(null,n.route,n.route),this.firstLoad=!1,this.isLoading=!1,n;app.data.invalidateTokensAndGoToLogin()}},logUserOut:function(){app.util.ajaxRequest({method:"GET",url:"/api/v1/logout",auth:!0},function(){app.data.invalidateTokensAndGoToLogin()})},isUserLoggedIn:function(){var e=app.data.getJwtFromStorage();return e&&e.length>30}},app.storeContent={init:function(){this.$storeInfo=$("#store-info"),this.$logo=$(".store-info-image"),this.$description=$("#store-info-description"),this.$logoEmpty=$(".store-info-image-empty"),this.$logoLoading=$(".store-info-image-loading"),this.$descriptionButton=$("#store-info-button-description"),this.$hoursButton=$("#store-info-button-hours"),this.$reviewsButton=$("#store-info-button-reviews"),this.$menuList=$("#store-menu-list"),this.$logoEmpty.hide(),this.$logoLoading.show(),this.$descriptionButton.on("click",function(){app.dialogs.description.show()}),this.$hoursButton.on("click",function(){app.dialogs.businessHours.show()}),this.$reviewsButton.on("click",function(){app.dialogs.reviews.show()})},resizeDescription:function(){this.$description[0].scrollHeight>this.$description.innerHeight()?this.$descriptionButton.show():this.$descriptionButton.hide()},addStoreDetailsDataToPage:function(e,t){t||(t=e,e=null);var o=this;if(e=e||app.data.getStoreIdFromStorage()){var a=new Image;a.src="/res/storelogos/store"+e+".jpg?"+Date.now(),a.onload=function(){o.$logo.attr("src",a.src),o.$logoEmpty.hide(),o.$logoLoading.hide()},a.onerror=function(){o.$logoLoading.hide(),o.$logoEmpty.show()};var i=t.address[0];i=i.street_address+" "+i.suburb+" "+i.postcode,$("#store-header-name").text(t.name),this.$description.text(t.description),$("#store-info-address").text(i),$("#store-info-phone-number").text(t.phone_number),$("#store-info-email").text(t.email),$("#store-disclaimer").text(t.disclaimer),$("#store-info-review-count").text("( "+t.review_count+" )"),$("#store-info-hours-is-open").text(),$("#store-info-hours-opens-at").text(),app.controls.RatingControls.setValue("#store-info-rating-control",Math.round(t.rating)),app.dialogs.description.update(t.name,t.description),app.dialogs.businessHours.update(t.hours),app.dialogs.reviews.update(t),$(window).on("resize",function(){o.resizeDescription()})}},addMenuDataToPage:function(e){var t=0,o=0,a=null,i=null,n=document.createDocumentFragment();if(e.products){for(t=0;t<e.products.length;t++){var s=(i=e.products[t]).options[0].price;for(o=0;o<i.options.length;o++)i.options[o].price<s&&(s=i.options[o].price);i.lowestOptionPrice=s,i.gluten_free&&(i.class1="label-gluten-free"),i.vegetarian&&(i.class2="label-vegetarian"),i.delivery_available||(i.class3="label-takeaway");var r=(a=app.util.loadTemplate("#template-store-menu-item",i,i.id_product,"data-product-id")).find(".store-menu-list-item-options > .store-menu-list-item-content").last(),l=null,p=i.options.length;for(o=0;o<i.options.length;o++)l=app.util.loadTemplate("#template-store-menu-option",i.options[o],i.options[o].id_product_option,"data-product-option-id"),screen.width>1e3&&l.css({width:100/p+"%"}),r.append(l[0]);n.append(a[0])}for(t=0;t<e.product_headings.length;t++){var u=e.product_headings[t],d=$(n).find(".store-menu-list-item[data-product-id='"+u.above_product_id+"']");d&&(a=app.util.loadTemplate("#template-store-menu-heading",u,u.id_product_heading,"data-heading-id")).insertBefore(d)}this.$menuList.append(n),$(".store-menu-list-item-details").on("click",function(){$(".store-menu-list-item").removeClass("options-active"),$(this).parent().addClass("options-active")}),$(".store-menu-list-item-options-cancel").on("click",function(){$(this).parent().parent().removeClass("options-active")}),new app.controls.CategoryScroller(e.product_headings)}else this.$menuList.append(app.Strings.noProducts)},getProduct:function(e){if(!e)return null;for(var t=0;t<this.storeData.products.length;t++)if(this.storeData.products[t].id_product==e)return this.storeData.products[t];return null},getProductOption:function(e){if(!e)return null;for(var t=null,o=0;o<this.storeData.products.length;o++)if(t=this.storeData.products[o].options)for(var a=0;a<t.length;a++)if(t[a].id_product_option==e)return t[a];return null}},void 0===app)&&((app={}).Strings=app.Strings={});app.util={checkIfObject:function(e){return!!e&&(e&&"object"==typeof e&&e.constructor===Object)},checkIfString:function(e){return"string"==typeof e||e instanceof String},checkIfDate:function(e){return!!e&&(e instanceof Date&&isFinite(e))},checkIfPositiveInteger:function(e,t){var o=parseInt(e);return!isNaN(o)&&(o=Number(e),!!Number.isInteger(o)&&(t?o>=0:o>0))},validateInputs:function(e,t){if(!e||!this.checkIfObject(e)||0===Object.keys(e).length)return console.log("validation inputs missing"),!1;if(!t)return console.log("validate rule undefined"),!1;var o=validate(e,t,{format:"flat"});return!(o&&o.length>0)||(this.showToast(o[0]),!1)},days:function(){return[app.Strings.daysMon,app.Strings.daysTue,app.Strings.daysWed,app.Strings.daysThu,app.Strings.daysFri,app.Strings.daysSat,app.Strings.daysSun]},getTodayIndex:function(e){var t=e?e.getDay():(new Date).getDay();return-1==(t-=1)&&(t=6),t},getTodayName:function(e){return this.days()[this.getTodayIndex(e)]},getTomorrowName:function(e){var t=this.getTodayIndex(e)+1;return t>6&&(t=0),this.days()[t]},toTitleCase:function(e){return e?e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""},setupTemplateFormatters:function(){$.addTemplateFormatter({lowestOptionPriceFormatter:function(e){return app.Strings.fromDollar+e},priceFormatter:function(e){return app.Strings.fromDollar+e.toFixed(2)},categoryArrayFormatter:function(e){return e.join(", ")},phoneNumberFormatter:function(e){return app.Strings.phone+" "+e},deliveryFormatter:function(e){return app.Strings.delivery+" "+e},minOrderFormatter:function(e){return app.Strings.minOrder+" "+e}})},isCordova:function(){return"true"==$("#is-cordova").val()},showToast:function(e,t,o){var a=$("#toasts"),i=$("<p class='"+(o||"")+"'>"+e+"</p>");a.children().length>=5&&a.children().first().animate({opacity:0,bottom:-50},100,function(){$(this).remove()}),a.append(i[0]),a.show(),i.animate({opacity:1,bottom:0},100),setTimeout(function(){a.children().first().animate({opacity:0,bottom:-50},100,function(){$(this).remove()}),0===a.children().length&&a.hide().empty()},t||2e3)},showLoadingScreen:function(){$("#loading-screen").show()},hideLoadingScreen:function(){$("#loading-screen").hide()},loadTemplate:function(e,t,o,a){var i=$("<div></div>").loadTemplate($(e),t,{isFile:!1});return i=i.children().first().unwrap(),a&&i.attr(a,o),i},checkToken:function(e){var t=this,o=app.data.getJwtFromStorage();if(!app.util.validateInputs(o,app.validationRules._people_jwt))return app.data.invalidateTokensAndGoToLogin(),e(app.Strings.invalidToken);this.ajaxRequest({method:"POST",url:"/api/v1/check-token",auth:!0},function(o,a){return o?(console.log(o),t.invalidateCredentials(),e(app.Strings.invalidToken)):(app.data.addJwtToStorage(a.data.jwt),app.data.addPersonIdToStorage(a.data.id_person),a.data.id_store&&a.data.id_store>0&&app.data.addStoreIdToStorage(a.data.id_store),e(null))})},preloadImages:function(e,t){for(var o=[],a=0,i=0;i<t.length;i++)o.push(new Image),o[i].src=e+t[i],o[i].onload=function(){++a===o.length&&(o=null)}},uploadImage:function(e,t){if(e&&e.length>0){if(e[0].size>25e4)return void this.showToast(app.Strings.imageFileTooBig);var o=new FormData;o.append("logo",e[0]),o.append("id_store",app.data.getStoreIdFromStorage()),this.ajaxRequest({method:"POST",url:"/api/v1/store-update-logo",auth:!0,isImage:!0,data:o},function(e,o){return!e&&o&&o.data&&o.data.url?t(null,o.data.url):(console.log(e),t(app.Strings.errorUploadingImage))})}else this.showToast(app.Strings.invalidImage)},ajaxRequest:function(e,t){var o=this,a="application/x-www-form-urlencoded; charser=UTF-8";e.isImage&&(a=!1);var i={method:e.method,url:e.url,data:e.data,cache:e.cache||!1,processData:!e.isImage,contentType:a,beforeSend:function(o){if(e.auth){var a=app.data.getJwtFromStorage();if(!app.util.validateInputs(a,app.validationRules._people_jwt))return o.abort(),app.data.invalidateTokensAndGoToLogin(),t(app.Strings.invalidToken);o.setRequestHeader("authorization","Bearer "+a)}},success:function(e){return t(null,e)},error:function(e){return console.log(e),e&&(e.responseJSON&&e.responseJSON.err?o.showToast(e.responseJSON.err,4e3):o.showToast(app.Strings.serverError,4e3)),t(e)}};e.dataType&&(i.dataType=e.dataType),$.ajax(i)}},app.validationRules={_sequence_id:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0}},_sequence_id_optional:{numericality:{onlyInteger:!0,greaterThan:0}},_email:{presence:!0,email:!0,length:{minimum:3,maximum:256}},_email_optional:{email:!0,length:{minimum:3,maximum:256}},_phone_number:{presence:!0,length:{minimum:3,maximum:32}},_phone_number_optional:{length:{minimum:3,maximum:32}},_url_link:{presence:!0,length:{maximum:256}},_url_link_optional:{length:{maximum:256}},_bit:{presence:!0,numericality:{onlyInteger:!0,greaterThanOrEqualTo:0,lessThanOrEqualTo:1}},_bit_optional:{numericality:{onlyInteger:!0,greaterThanOrEqualTo:0,lessThanOrEqualTo:1}},_notes_optional:{length:{maximum:256}},_price:{presence:!0,numericality:{greaterThanOrEqualTo:0}},_price_optional:{numericality:{greaterThanOrEqualTo:0}},_quantity:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0}},_latitude_optional:{numericality:{greaterThanOrEqualTo:0}},_longitude_optional:{numericality:{greaterThanOrEqualTo:0}},_addresses_street_address:{presence:!0,length:{maximum:256}},_people_first_name:{presence:!0,length:{minimum:2,maximum:45}},_people_first_name_optional:{length:{minimum:2,maximum:45}},_people_last_name:{presence:!0,length:{minimum:2,maximum:45}},_people_last_name_optional:{length:{minimum:2,maximum:45}},_people_password:{presence:!0,length:{minimum:3,maximum:64}},_people_reset_password_token:{presence:!0,length:64},_people_reset_password_token_optional:{presence:!0,length:64},_people_jwt:{presence:!0,length:{minimum:30,maximum:512}},_people_jwt_optional:{length:{minimum:30,maximum:512}},_people_verification_token:{presence:!0,length:64},_postcodes_postcode:{presence:!0,length:{minimum:1,maximum:6}},_postcodes_suburb:{presence:!0,length:{minimum:1,maximum:64}},_postcodes_state:{presence:!0,length:{minimum:1,maximum:32}},_reviews_title:{presence:!0,length:{minimum:2,maximum:128}},_reviews_review_optional:{length:{maximum:512}},_reviews_rating:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0,lessThan:6}},_stores_name:{presence:!0,length:{maximum:512}},_stores_description_optional:{length:{maximum:1024}},_stores_abn:{presence:!0,length:{minimum:10,maximum:32}},_stores_bank_name:{presence:!0,length:{minimum:2,maximum:128}},_stores_bank_bsb:{presence:!0,length:{minimum:6,maximum:16}},_stores_bank_account_name:{presence:!0,length:{minimum:2,maximum:128}},_stores_bank_account_number:{presence:!0,length:{minimum:2,maximum:32}},_stores_hours:{length:{maximum:5}},_product_extras_name:{presence:!0,length:{maximum:32}},_product_options_name:{presence:!0,length:{maximum:32}},_products_name:{presence:!0,length:{maximum:64}},_products_description_optional:{length:{maximum:256}},_order_products_customer_notes_optional:{length:{maximum:256}},_orders_notes_optional:{length:{maximum:256}},_orders_expiry:{presence:!0,datetime:!0},_transactions_commission:{presence:!0,numericality:{greaterThanOrEqualTo:0,lessThanOrEqualTo:1e3}},_transactions_processing_fee:{presence:!0,numericality:{greaterThanOrEqualTo:0,lessThanOrEqualTo:1e3}}},app.validationRules.login={email:app.validationRules._email,password:app.validationRules._people_password},app.validationRules.createUser={first_name:app.validationRules._people_first_name,last_name:app.validationRules._people_last_name,email:app.validationRules._email,password:app.validationRules._people_password,confirmPassword:{equality:"password"}},app.validationRules.storeApplication={name:{presence:!0,length:{maximum:128}},email:app.validationRules._email,message:{length:{maximum:256}}},app.validationRules.forgotPassword={email:app.validationRules._email},app.validationRules.verifyAccount={email:app.validationRules._email,password:app.validationRules._people_password,verification_token:app.validationRules._people_verification_token},app.validationRules.resetPassword={email:app.validationRules._people_email,password:app.validationRules._people_password,confirmPassword:{equality:"password"},reset_password_token:app.validationRules._people_reset_password_token},app.validationRules.createStore={postcode:app.validationRules._postcodes_postcode,suburb:app.validationRules._postcodes_suburb,street_address:app.validationRules._addresses_street_address,first_name:app.validationRules._people_first_name,last_name:app.validationRules._people_last_name,phone_number_user:app.validationRules._phone_number,email_user:app.validationRules._email,password:app.validationRules._people_password,name:app.validationRules._stores_name,abn:app.validationRules._stores_abn,internal_notes_store:app.validationRules._notes_optional},app.validationRules.deleteStore={id_store:app.validationRules._sequence_id},app.validationRules.updateStoreDetails={description:app.validationRules._stores_description_optional,street_address:app.validationRules._addresses_street_address,postcode:app.validationRules._postcodes_postcode,suburb:app.validationRules._postcodes_suburb,phone_number:app.validationRules._phone_number,email:app.validationRules._phone_email,hours_mon_dinein_open:app.validationRules._stores_hours,hours_tue_dinein_open:app.validationRules._stores_hours,hours_wed_dinein_open:app.validationRules._stores_hours,hours_thu_dinein_open:app.validationRules._stores_hours,hours_fri_dinein_open:app.validationRules._stores_hours,hours_sat_dinein_open:app.validationRules._stores_hours,hours_sun_dinein_open:app.validationRules._stores_hours,hours_mon_dinein_close:app.validationRules._stores_hours,hours_tue_dinein_close:app.validationRules._stores_hours,hours_wed_dinein_close:app.validationRules._stores_hours,hours_thu_dinein_close:app.validationRules._stores_hours,hours_fri_dinein_close:app.validationRules._stores_hours,hours_sat_dinein_close:app.validationRules._stores_hours,hours_sun_dinein_close:app.validationRules._stores_hours,hours_mon_delivery_open:app.validationRules._stores_hours,hours_tue_delivery_open:app.validationRules._stores_hours,hours_wed_delivery_open:app.validationRules._stores_hours,hours_thu_delivery_open:app.validationRules._stores_hours,hours_fri_delivery_open:app.validationRules._stores_hours,hours_sat_delivery_open:app.validationRules._stores_hours,hours_sun_delivery_open:app.validationRules._stores_hours,hours_mon_delivery_close:app.validationRules._stores_hours,hours_tue_delivery_close:app.validationRules._stores_hours,hours_wed_delivery_close:app.validationRules._stores_hours,hours_thu_delivery_close:app.validationRules._stores_hours,hours_fri_delivery_close:app.validationRules._stores_hours,hours_sat_delivery_close:app.validationRules._stores_hours,hours_sun_delivery_close:app.validationRules._stores_hours},app.validationRules.getStore={id_store:app.validationRules._sequence_id},app.validationRules.validateHours=function(e){if(!e||0===Object.keys(e).length)return"Data missing";for(var t=null,o=null,a=Object.keys(e),i=0;i<a.length;i++)if(0===a[i].indexOf("hours_"))if(e[a[i]]){if(5!==e[a[i]].length||!e[a[i]].match(/\d{2}:\d{2}/))return o=(t=a[i].split("_"))[1]+" "+t[2]+" "+t[3],"Error in Hours "+(o=app.util.toTitleCase(o))+".  Must be HH:MM"}else{var n="open"===(t=a[i].split("_"))[3]?"close":"open";if(o=t[1]+" "+t[2]+" "+t[3],o=app.util.toTitleCase(o),e[t=t[0]+"_"+t[1]+"_"+t[2]+"_"+n])return"Error in Hours "+o+".  Open and Close must be both times or both closed"}return null},app.controls.CategoryScroller=function(e){var t=$("html"),o=".category-scroller-list",a=$(".category-scroller-container"),i=$(".category-scroller"),n=$(o),s=[],r=$(".store-menu-list-item.heading"),l=0,p=[];function u(){p=[],r.each(function(){p.push(this.getBoundingClientRect().top+t.scrollTop())})}function d(){var e=t.scrollTop();for(l=p.length-1;l>=0;l--)if(e>p[l]-110){s.removeClass("active"),$(s[l]).addClass("active");break}}var c=null,h=document.createDocumentFragment();for(l=0;l<e.length;l++)c=$("<li class='store-menu-nav-list-item'>"+e[l].title+"</li>"),h.append(c[0]);n.append(h),new app.controls.HorizontalScroller(o,function(e){var o=$(".store-menu-list-item.heading:contains('"+e.innerText+"')"),a=(screen.width,100);o[0]&&$("html").animate({scrollTop:o[0].getBoundingClientRect().top+t.scrollTop()-a},500)}),$(window).on("resize",function(){u(),d()}),$(window).on("scroll",function(){s.length&&(a[0].getBoundingClientRect().top<20?i.addClass("floating"):i.removeClass("floating"),d())}),s=$(".store-menu-nav-list-item"),u()},app.controls.Navbar=function(){var e=this;$(".navbar a").on("click",function(t){if("logout"==this.innerText.toLowerCase())return app.routerBase.logUserOut(),!1;var o=this.href.replace(window.location.origin,"");return e.linkClicked(t,o),!1}),$(".navbar-links-popup-button").on("click",function(){$(".navbar-links-popup").animate({right:0},200)}),$(".navbar-links-popup-close").on("click",function(){$(".navbar-links-popup").animate({right:-250},200)}),$(".navbar-icon").on("click",function(e){e.ctrlKey?window.location.href="/admin-login":window.location.href="/location/Balmoral-4171"})},app.controls.Navbar.prototype.linkClicked=function(){},app.controls.RatingControls={setValue:function(e,t){for(var o=$(e),a=0;a<t;a++)o.children().eq(a).addClass("active")},getValue:function(e){return $(e+" .rating-control-star.active").length},updateRatingControls:function(e){for(var t=0;t<e.length;t++)if(e[t].id_review)for(var o=$(".rating-control-stars.user[data-id='"+e[t].id_review+"']"),a=0;a<e[t].rating;a++)o.children().eq(a).addClass("active")},recreateRatingControlEvents:function(){$(".rating-control-star").off(),$(".rating-control-star").unbind();var e=!1;$(".rating-control-star").on("click",function(){$(this).hasClass("active")||$(this).siblings().hasClass("active")||(e=!0),console.log(e),$(this).removeClass("active"),$(this).siblings().removeClass("active"),$(this).addClass("active"),$(this).prevAll().addClass("active")})}},app.controls.Resizer=function(e,t,o,a,i){var n=$(t),s=$(o),r=0,l=0,p=!1,u=0;n.on("mousedown",function(e){p=!0,r=e.clientX,l=e.clientY,console.log(r,l)}),$(window).on("mousemove",function(e){e.preventDefault(),p&&(s.show(),u=window.innerHeight-e.clientY-a,s.height(u),i&&i())}),$(window).on("mouseup",function(){p=!1})},app.controls.HorizontalScroller=function(e,t){var o=this,a=!1;this.startMouseX=0;var i=0,n=!1;this.diff=0,this.scrollBlurTolerance=5,this.$scrollerList=$(e),this.$scrollBlurLeft=this.$scrollerList.prev(),this.$scrollBlurRight=this.$scrollerList.next(),this.$scrollerList.on("mousedown",function(e){a=!0,n=!1,o.startMouseX=e.clientX,i=$(this).scrollLeft()}),$(window).on("mousemove",function(e){a&&(e.stopPropagation(),o.$scrollerList.scrollLeft(i-(e.clientX-o.startMouseX)),o.isInsideTolerance(e.clientX)||(n=!0))}),$(window).on("mouseup",function(){a=!1}),this.$scrollerList.on("mouseup",function(e){if(!n)return t(e.target);n=!1}),this.$scrollerList.on("scroll",function(){o.updateScrollBlurs()}),$(window).on("resize",function(){o.updateScrollBlurs()}),this.updateScrollBlurs()},app.controls.HorizontalScroller.prototype.updateScrollBlurs=function(){this.$scrollerList[0].scrollLeft>this.scrollBlurTolerance?this.$scrollBlurLeft.show():this.$scrollBlurLeft.hide(),this.$scrollerList[0].scrollLeft+this.$scrollerList[0].clientWidth<this.$scrollerList[0].scrollWidth-this.scrollBlurTolerance?this.$scrollBlurRight.show():this.$scrollBlurRight.hide()},app.controls.HorizontalScroller.prototype.isInsideTolerance=function(e){return this.diff=e-this.startMouseX,this.diff>=-this.scrollBlurTolerance&&this.diff<=this.scrollBlurTolerance},app.controls.Typeahead=function(e){var t=this;this.$typeaheadInput=$("#typeahead-suburb-search"),this.$typeaheadList=$("#typeahead-suburb-list");var o=null;function a(o){var a={suburb:$(o).find(".typeahead-item-suburb").text(),postcode:$(o).find(".typeahead-item-postcode").text()};if(t.$typeaheadList.hide(),t.$typeaheadInput.attr("data-suburb",""),t.$typeaheadInput.attr("data-postcode",""),!a.suburb||!a.postcode)return e(null);t.setValue(a.postcode,a.suburb);var i=encodeURIComponent(a.suburb+"-"+a.postcode);return e(a,i)}this.baseUrl="/api/v1/location?q=",this.$typeaheadList.on("click",function(e){a(e.target)}),this.$typeaheadInput.on("focus",function(){this.setSelectionRange(0,this.value.length)}),this.$typeaheadInput.on("blur",function(){var e=t.getValue();e.suburb&&e.postcode?t.setValue(e.postcode,e.suburb):(t.$typeaheadInput.attr("data-suburb",""),t.$typeaheadInput.attr("data-postcode",""),t.$typeaheadInput.val(""))}),this.$typeaheadInput.on("keyup",function(e){var i=0,n=[],s=$(this).val().toLowerCase();if(27!=e.which)if(13!=e.which)if(38!=e.which)if(40!=e.which)clearTimeout(o),o=setTimeout(function(){if(s){var e=t.baseUrl+s;app.util.ajaxRequest({method:"GET",url:e},function(e,o){if(!e){var a=[];for(i=0;i<o.data.length;i++)a.push("<li class='typeahead-item'><label class='typeahead-item-postcode'>"+o.data[i].postcode+"</label><span>♔</span><label class='typeahead-item-suburb'>"+app.util.toTitleCase(o.data[i].suburb)+"</label></li>");t.$typeaheadList.empty(),a.length>0?(t.$typeaheadList.append(a.join("")),t.$typeaheadList.show()):(t.$typeaheadList.show(),t.$typeaheadList.append("<li class='typeahead-item'>"+app.Strings.noResults+"</li>"))}})}else t.$typeaheadList.hide()},500);else for(n=$(".typeahead-item"),i=n.length-1;i>=0;i--){if($(n[i]).hasClass("active")){$(n[i]).removeClass("active"),$(n[i]).next().addClass("active");break}0==i&&$(n[0]).addClass("active")}else for(n=$(".typeahead-item"),i=0;i<n.length;i++){if($(n[i]).hasClass("active")){$(n[i]).removeClass("active"),$(n[i]).prev().addClass("active");break}i==n.length-1&&$(n[n.length-1]).addClass("active")}else{var r=$(".typeahead-item.active");r.length>0&&a(r[0])}}),$(window).on("mousedown",function(e){"typeahead-item"!=e.target.className&&t.$typeaheadList.hide()}),$(window).on("keydown",function(e){27==e.which&&t.$typeaheadList.hide()})},app.controls.Typeahead.prototype.setValue=function(e,t){this.$typeaheadInput.val(e+" - "+t),this.$typeaheadInput.attr("data-suburb",t),this.$typeaheadInput.attr("data-postcode",e)},app.controls.Typeahead.prototype.getValue=function(){return{suburb:this.$typeaheadInput.attr("data-suburb"),postcode:this.$typeaheadInput.attr("data-postcode")}};