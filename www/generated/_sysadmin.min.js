"use strict";var app=app||{};app.controls=app.controls||{},app.dialogs=app.dialogs||{},app.sysadmin={htmlFiles:{},init:function(e){this.htmlFiles=e,app.dialogs.init(),app.routerBase.init(),app.routerBase.loadPageForRoute(null,"sysadmin")},onPageChanged:function(){$("#navbar-link-logout").on("click",function(){app.routerBase.logUserOut()})},normalizeRoute:function(e){return{route:e,match:!0}},routes:{"/sysadmin/create-store":{title:"SysAdmin - Create Store",file:"create-store",initFunction:function(e){app.sysadmin.createStore.init(e)}},"/sysadmin/edit-store":{title:"SysAdmin - Edit Store",file:"edit-store",initFunction:function(e){app.sysadmin.editStore.init(e)}},"/sysadmin/database":{title:"SysAdmin - Database",file:"database",initFunction:function(e){app.sysadmin.database.init(e)}}}},app.sysadmin.routesList=Object.keys(app.sysadmin.routes),app.sysadmin.createStore={init:function(){}},app.sysadmin.database={init:function(){}},app.sysadmin.editStore={init:function(){}},app.dialogs.businessHours={days:["MON","TUE","WED","THU","FRI","SAT","SUN"],init:function(){var e=this;$("#dialog-store-hours-close").on("click",function(){e.hide()})},update:function(e,t){this.addHoursToList(e.slice(0,7),"#dialog-store-hours-left"),this.addHoursToList(e.slice(7,14),"#dialog-store-hours-right");for(var o="",a=document.createDocumentFragment(),i=0;i<7;i++)o="c"===e[i].opens?"closed":e[i].opens+" to "+e[i].closes,a.append($("<li><span>"+this.days[i]+"</span> "+o+"</li>")[0]);$(t).empty().append(a)},show:function(){app.dialogs.show("#dialog-store-hours")},hide:function(){app.dialogs.hide()}},app.dialogs.description={init:function(){var e=this;$("#dialog-store-description-close").on("click",function(){e.hide()})},update:function(e,t){$("#dialog-store-description-heading").text(e),$("#dialog-store-description-text").text(t)},show:function(){app.dialogs.show("#dialog-store-description")},hide:function(){app.dialogs.hide()}},app.dialogs.init=function(){Object.keys(this).forEach(function(e){app.dialogs[e].init&&app.dialogs[e].init()}),this.$dialogContainer=$("#dialog-container"),this.$dialogs=this.$dialogContainer.children(),this.$dialogContainer.on("click",function(){})},app.dialogs.show=function(e){this.$dialogContainer.show(),$(e).show()},app.dialogs.hide=function(){this.$dialogs.hide(),this.$dialogContainer.hide()},app.dialogs.reviews={init:function(){var e=this;$("#dialog-store-reviews-add-review").on("click",function(){app.util.showToast("not working yet")}),$("#dialog-store-reviews-close").on("click",function(){e.hide()})},update:function(e){$("#dialog-store-reviews-count").text("( "+e.review_count+" )"),app.controls.RatingControls.setValue("#dialog-store-reviews-rating-control",Math.round(e.rating));for(var t=document.createDocumentFragment(),o=0;o<e.reviews.length;o++){var a="<li class='rating-control-star "+(e.reviews[o].rating>.5?"active":"")+"'></li><li class='rating-control-star "+(e.reviews[o].rating>1.5?"active":"")+"'></li><li class='rating-control-star "+(e.reviews[o].rating>2.5?"active":"")+"'></li><li class='rating-control-star "+(e.reviews[o].rating>3.5?"active":"")+"'></li><li class='rating-control-star "+(e.reviews[o].rating>4.5?"active":"")+"'></li>";t.append($("<div class='store-reviews-list-item'><div class='store-reviews-list-item-header'><ul class='rating-control inactive'>"+a+"</ul><label>"+e.reviews[o].title+"</label></div><p>"+e.reviews[o].review+"</p></div>")[0])}$("#dialog-store-reviews-list").empty().append(t)},show:function(){app.dialogs.show("#dialog-store-reviews")},hide:function(){app.dialogs.hide()}},app.i18n={},app.i18n.en={storeIdMissing:"Store Id missing",imageFileMissing:"Image file missing",imageFileWrongType:"Incorrect image type.  Only Jpg is supported",imageFileTooBig:"Image file size too big.  Must be < 250kB"},app.routerBase={firstLoad:!0,lastLoadedSection:"",isLoading:!1,init:function(){document.addEventListener("deviceready",function(){app.cordova.init()},!1)},loadPageForRoute:function(e,t,o){if(!this.isLoading&&window.location.pathname!==e){var a=this;this.isLoading=!0,this.lastLoadedSection=t,$(window).off(),$(document).off(),window.onpopstate=function(){console.log("on popstate "+window.location.pathname),a.loadPageForRoute(window.location.pathname,a.lastLoadedSection,!0)};var i=this.getCurrentRouteData(e,t);return $("#page-container").empty(),$("#page-container").append(i.html),$("html, body").animate({scrollTop:0},200),app[t].routes[i.normalizedRoute].initFunction(i),app[t].onPageChanged(i),$("body").css("display","block"),a.firstLoad||o||i.route!=window.location.pathname&&window.history.pushState(null,i.route,i.route),a.firstLoad=!1,a.isLoading=!1,document.title=i.title,i}},getCurrentRouteData:function(e,t){var o=e||window.location.pathname,a={route:o};if(app.util.isCordova()&&"/index-cordova"==(o=o.substring(o.lastIndexOf("/"),o.length-5))&&(o="/"),a.normalizedRoute=app[t].normalizeRoute(o).route,a.section=t,-1!==app[t].routesList.indexOf(a.normalizedRoute))return a.html=app[t].htmlFiles[a.normalizedRoute],$.extend(a,app[t].routes[a.normalizedRoute]),a;app.util.invalidateCredentialsAndGoToLogin()},logUserOut:function(){app.util.ajaxRequest({method:"GET",url:"/api/v1/logout",auth:!0},function(){app.util.invalidateCredentialsAndGoToLogin()})},isUserLoggedIn:function(){var e=app.util.getJwtFromStorage();return e&&e.length>30}},app.storeContent={storeDataRequestNotAllowed:!1,storeData:{},init:function(){this.$logo=$(".store-info-image"),this.$description=$("#store-info-description"),this.$logoEmpty=$(".store-info-image-empty"),this.$logoLoading=$(".store-info-image-loading"),this.$descriptionButton=$("#store-info-button-description"),this.$menuList=$("#store-menu-list"),this.$logoEmpty.hide(),this.$logoLoading.show(),this.id_store=app.util.getStoreIdFromStorage(),$("#store-info-button-description").on("click",function(){app.dialogs.description.show()}),$("#store-info-button-hours").on("click",function(){app.dialogs.businessHours.show()}),$("#store-info-button-reviews").on("click",function(){app.dialogs.reviews.show()})},resizeDescription:function(){this.$description[0].scrollHeight>this.$description.innerHeight()?this.$descriptionButton.show():this.$descriptionButton.hide()},addStoreDetailsDataToPage:function(e){var t=this,o=new Image;o.src="/res/storelogos/store"+this.id_store+".jpg?"+Date.now(),o.onload=function(){t.$logo.attr("src",o.src),t.$logoEmpty.hide(),t.$logoLoading.hide()},o.onerror=function(){t.$logoLoading.hide(),t.$logoEmpty.show()};var a=e.address[0];a=a.street_address+" "+a.suburb+" "+a.postcode,$("#store-header-name").text(e.name),this.$description.text(e.description),$("#store-info-address").text(a),$("#store-info-phone-number").text(e.phone_number),$("#store-info-email").text(e.email),$("#store-disclaimer").text(e.disclaimer),$("#store-info-review-count").text("( "+e.review_count+" )"),app.controls.RatingControls.setValue("#store-info-rating-control",Math.round(e.rating)),app.dialogs.description.init(e.name,e.description),app.dialogs.businessHours.init(e.hours),app.dialogs.reviews.init(e),$(window).on("resize",function(){t.resizeDescription()})},addMenuDataToPage:function(e){var t=0,o=0,a=null,i=null,n=document.createDocumentFragment();if(e.products){for(e.products[0].name="testest testest testest testestttestest testest testest testestt",e.product_headings[0].title="testest testest testest testestt",e.products[0].options[0].name="testest testest testest testestt",t=0;t<e.products.length;t++){var s=(i=e.products[t]).options[0].price;for(o=0;o<i.options.length;o++)i.options[o].price<s&&(s=i.options[o].price);i.lowestOptionPrice=s,i.gluten_free&&(i.class1="label-gluten-free"),i.vegetarian&&(i.class2="label-vegetarian"),i.delivery_available||(i.class3="label-takeaway");var r=(a=app.util.loadTemplate("#template-store-menu-item",i,i.id_product,"data-product-id")).find(".store-menu-list-item-options > div").first(),l=null,p=i.options.length;for(o=0;o<i.options.length;o++)(l=app.util.loadTemplate("#template-store-menu-option",i.options[o],i.options[o].id_product_option,"data-product-option-id")).css({width:100/p+"%"}),r.append(l[0]);n.append(a[0])}for(t=0;t<e.product_headings.length;t++){var u=e.product_headings[t],d=$(n).find(".store-menu-list-item[data-product-id='"+u.above_product_id+"']");d&&(a=app.util.loadTemplate("#template-store-menu-heading",u,u.id_product_heading,"data-heading-id")).insertBefore(d)}this.$menuList.append(n),$(".store-menu-list-item-details").on("click",function(){$(this).next().addClass("active")}),$(".store-menu-list-item-options-cancel").on("click",function(){$(this).parent().removeClass("active")}),new app.controls.CategoryScroller(e.product_headings)}else this.$menuList.append("No Products")},getStoreData:function(e){var t=this;return this.storeDataRequestNotAllowed?e(this.storeData):!!app.util.validateInputs({id_store:this.id_store},app.validationRules.getStore)&&(this.storeDataRequestNotAllowed=!0,setTimeout(function(){t.storeDataRequestNotAllowed=!1},2e3),void app.util.ajaxRequest({method:"GET",url:"/api/v1/store?id_store="+this.id_store,cache:!0},function(o,a){if(!o)return a.data.hours=a.data.hours[0],t.storeData=a.data,e(t.storeData)}))}},app.util={setupTemplateFormatters:function(){$.addTemplateFormatter({lowestOptionPriceFormatter:function(e){return"From $"+e},priceFormatter:function(e){return"$"+e.toFixed(2)},categoryArrayFormatter:function(e){return e.join(", ")},phoneNumberFormatter:function(e){return"Ph: "+e},deliveryFormatter:function(e){return"Delivery "+e},minOrderFormatter:function(e){return"Min. Order "+e}})},validateInputs:function(e,t){if(!t)return console.log("validate rule undefined"),!1;var o=validate(e,t,{format:"flat"});return!(o&&o.length>0)||(this.showToast(o[0]),!1)},isCordova:function(){return"true"==$("#is-cordova").val()},showToast:function(e,t,o){var a=$("#toasts"),i=$("<p class='"+(o||"")+"'>"+e+"</p>");a.children().length>=5&&a.children().first().animate({opacity:0,bottom:-50},100,function(){$(this).remove()}),a.append(i[0]),a.show(),i.animate({opacity:1,bottom:0},100),setTimeout(function(){a.children().first().animate({opacity:0,bottom:-50},100,function(){$(this).remove()}),0===a.children().length&&a.hide().empty()},t||2e3)},showLoadingScreen:function(){$("#loading-screen").show()},hideLoadingScreen:function(){$("#loading-screen").hide()},toTitleCase:function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},loadTemplate:function(e,t,o,a){var i=$("<div></div>").loadTemplate($(e),t,{isFile:!1});return i=i.children().first().unwrap(),a&&i.attr(a,o),i},addJwtToStorage:function(e){localStorage.setItem("jwt",e)},getJwtFromStorage:function(){return localStorage.getItem("jwt")},addPersonIdToStorage:function(e){localStorage.setItem("pid",e)},getPersonIdFromStorage:function(){return Number(localStorage.getItem("pid"))},addStoreIdToStorage:function(e){localStorage.setItem("sid",e)},getStoreIdFromStorage:function(){return Number(localStorage.getItem("sid"))},invalidateCredentialsAndGoToLogin:function(){localStorage.removeItem("jwt"),localStorage.removeItem("pid"),localStorage.removeItem("sid"),window.location.href="/login"},checkToken:function(e){var t=this,o=this.getJwtFromStorage();if(!(o&&o.length>30))return this.invalidateCredentials(),e("invalid token");this.ajaxRequest({method:"POST",url:"/api/v1/check-token",auth:!0},function(o,a){return o?(console.log(o),t.invalidateCredentials(),e("invalid token")):(t.addJwtToStorage(a.data.jwt),t.addPersonIdToStorage(a.data.id_person),a.data.id_store&&a.data.id_store>0&&t.addStoreIdToStorage(a.data.id_store),e(null))})},preloadImages:function(e,t){for(var o=[],a=0,i=0;i<t.length;i++)o.push(new Image),o[i].src=e+t[i],o[i].onload=function(){++a===o.length&&(o=null)}},uploadImage:function(e,t){if(e&&e.length>0){if(e[0].size>25e4)return void this.showToast("Image file size too big.  Must be < 250kB");var o=new FormData;o.append("logo",e[0]),o.append("id_store",this.getStoreIdFromStorage()),this.ajaxRequest({method:"POST",url:"/api/v1/store-update-logo",auth:!0,isImage:!0,data:o},function(e,o){return!e&&o&&o.data&&o.data.url?t(null,o.data.url):(console.log(e),t("Error uploading image"))})}else this.showToast("Invalid Image")},ajaxRequest:function(e,t){var o=this,a="application/x-www-form-urlencoded; charser=UTF-8";e.isImage&&(a=!1);var i={method:e.method,url:e.url,data:e.data,cache:e.cache||!1,processData:!e.isImage,contentType:a,beforeSend:function(t){e.auth&&t.setRequestHeader("authorization","Bearer "+app.util.getJwtFromStorage())},success:function(e){return t(null,e)},error:function(e){return console.log(e),e&&(e.responseJSON&&e.responseJSON.err?o.showToast(e.responseJSON.err,4e3):o.showToast("Server Error",4e3)),t(e)}};e.dataType&&(i.dataType=e.dataType),$.ajax(i)}},app.validationRules={_sequence_id:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0}},_sequence_id_optional:{numericality:{onlyInteger:!0,greaterThan:0}},_email:{presence:!0,email:!0,length:{minimum:3,maximum:256}},_email_optional:{email:!0,length:{minimum:3,maximum:256}},_phone_number:{presence:!0,length:{minimum:3,maximum:32}},_phone_number_optional:{length:{minimum:3,maximum:32}},_url_link:{presence:!0,length:{maximum:256}},_url_link_optional:{length:{maximum:256}},_bit:{presence:!0,numericality:{onlyInteger:!0,greaterThanOrEqualTo:0,lessThanOrEqualTo:1}},_bit_optional:{numericality:{onlyInteger:!0,greaterThanOrEqualTo:0,lessThanOrEqualTo:1}},_notes_optional:{length:{maximum:256}},_price:{presence:!0,numericality:{greaterThanOrEqualTo:0}},_price_optional:{numericality:{greaterThanOrEqualTo:0}},_quantity:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0}},_latitude_optional:{numericality:{greaterThanOrEqualTo:0}},_longitude_optional:{numericality:{greaterThanOrEqualTo:0}},_addresses_street_address:{presence:!0,length:{maximum:256}},_people_first_name:{presence:!0,length:{minimum:2,maximum:45}},_people_first_name_optional:{length:{minimum:2,maximum:45}},_people_last_name:{presence:!0,length:{minimum:2,maximum:45}},_people_last_name_optional:{length:{minimum:2,maximum:45}},_people_password:{presence:!0,length:{minimum:3,maximum:64}},_people_reset_password_token:{presence:!0,length:64},_people_reset_password_token_optional:{presence:!0,length:64},_people_jwt:{presence:!0,length:{minimum:30,maximum:512}},_people_jwt_optional:{length:{minimum:30,maximum:512}},_people_verification_token:{presence:!0,length:64},_postcodes_postcode:{presence:!0,length:{minimum:1,maximum:6}},_postcodes_suburb:{presence:!0,length:{minimum:1,maximum:64}},_postcodes_state:{presence:!0,length:{minimum:1,maximum:32}},_reviews_title:{presence:!0,length:{minimum:2,maximum:128}},_reviews_review_optional:{length:{maximum:512}},_reviews_rating:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0,lessThan:6}},_stores_name:{presence:!0,length:{maximum:512}},_stores_description_optional:{length:{maximum:1024}},_stores_abn:{presence:!0,length:{minimum:10,maximum:32}},_stores_bank_name:{presence:!0,length:{minimum:2,maximum:128}},_stores_bank_bsb:{presence:!0,length:{minimum:6,maximum:16}},_stores_bank_account_name:{presence:!0,length:{minimum:2,maximum:128}},_stores_bank_account_number:{presence:!0,length:{minimum:2,maximum:32}},_stores_hours:{length:{maximum:5}},_product_extras_name:{presence:!0,length:{maximum:32}},_product_options_name:{presence:!0,length:{maximum:32}},_products_name:{presence:!0,length:{maximum:64}},_products_description_optional:{length:{maximum:256}},_order_products_customer_notes_optional:{length:{maximum:256}},_orders_notes_optional:{length:{maximum:256}},_orders_expiry:{presence:!0,datetime:!0},_transactions_commission:{presence:!0,numericality:{greaterThanOrEqualTo:0,lessThanOrEqualTo:1e3}},_transactions_processing_fee:{presence:!0,numericality:{greaterThanOrEqualTo:0,lessThanOrEqualTo:1e3}}},app.validationRules.login={email:app.validationRules._email,password:app.validationRules._people_password},app.validationRules.createUser={first_name:app.validationRules._people_first_name,last_name:app.validationRules._people_last_name,email:app.validationRules._email,password:app.validationRules._people_password,confirmPassword:{equality:"password"}},app.validationRules.storeApplication={name:{presence:!0,length:{maximum:128}},email:app.validationRules._email,message:{length:{maximum:256}}},app.validationRules.forgotPassword={email:app.validationRules._email},app.validationRules.verifyAccount={email:app.validationRules._email,password:app.validationRules._people_password,verification_token:app.validationRules._people_verification_token},app.validationRules.resetPassword={email:app.validationRules._people_email,password:app.validationRules._people_password,confirmPassword:{equality:"password"},reset_password_token:app.validationRules._people_reset_password_token},app.validationRules.createStore={postcode:app.validationRules._postcodes_postcode,suburb:app.validationRules._postcodes_suburb,street_address:app.validationRules._addresses_street_address,first_name:app.validationRules._people_first_name,last_name:app.validationRules._people_last_name,phone_number_user:app.validationRules._phone_number,email_user:app.validationRules._email,password:app.validationRules._people_password,name:app.validationRules._stores_name,abn:app.validationRules._stores_abn,internal_notes_store:app.validationRules._notes_optional},app.validationRules.deleteStore={id_store:app.validationRules._sequence_id},app.validationRules.updateStoreDetails={description:app.validationRules._stores_description_optional,street_address:app.validationRules._addresses_street_address,postcode:app.validationRules._postcodes_postcode,suburb:app.validationRules._postcodes_suburb,phone_number:app.validationRules._phone_number,email:app.validationRules._phone_email,hours_mon_dinein_open:app.validationRules._stores_hours,hours_tue_dinein_open:app.validationRules._stores_hours,hours_wed_dinein_open:app.validationRules._stores_hours,hours_thu_dinein_open:app.validationRules._stores_hours,hours_fri_dinein_open:app.validationRules._stores_hours,hours_sat_dinein_open:app.validationRules._stores_hours,hours_sun_dinein_open:app.validationRules._stores_hours,hours_mon_dinein_close:app.validationRules._stores_hours,hours_tue_dinein_close:app.validationRules._stores_hours,hours_wed_dinein_close:app.validationRules._stores_hours,hours_thu_dinein_close:app.validationRules._stores_hours,hours_fri_dinein_close:app.validationRules._stores_hours,hours_sat_dinein_close:app.validationRules._stores_hours,hours_sun_dinein_close:app.validationRules._stores_hours,hours_mon_delivery_open:app.validationRules._stores_hours,hours_tue_delivery_open:app.validationRules._stores_hours,hours_wed_delivery_open:app.validationRules._stores_hours,hours_thu_delivery_open:app.validationRules._stores_hours,hours_fri_delivery_open:app.validationRules._stores_hours,hours_sat_delivery_open:app.validationRules._stores_hours,hours_sun_delivery_open:app.validationRules._stores_hours,hours_mon_delivery_close:app.validationRules._stores_hours,hours_tue_delivery_close:app.validationRules._stores_hours,hours_wed_delivery_close:app.validationRules._stores_hours,hours_thu_delivery_close:app.validationRules._stores_hours,hours_fri_delivery_close:app.validationRules._stores_hours,hours_sat_delivery_close:app.validationRules._stores_hours,hours_sun_delivery_close:app.validationRules._stores_hours},app.validationRules.getStore={id_store:app.validationRules._sequence_id},app.validationRules.validateHours=function(e){if(!e||0===Object.keys(e).length)return"Data missing";for(var t=null,o=null,a=Object.keys(e),i=0;i<a.length;i++)if(0===a[i].indexOf("hours_"))if(e[a[i]]){if(5!==e[a[i]].length||!e[a[i]].match(/\d{2}:\d{2}/))return o=(t=a[i].split("_"))[1]+" "+t[2]+" "+t[3],"Error in Hours "+(o=app.util.toTitleCase(o))+".  Must be HH:MM"}else{var n="open"===(t=a[i].split("_"))[3]?"close":"open";if(o=t[1]+" "+t[2]+" "+t[3],o=app.util.toTitleCase(o),e[t=t[0]+"_"+t[1]+"_"+t[2]+"_"+n])return"Error in Hours "+o+".  Open and Close must be both times or both closed"}return null},app.controls.CategoryScroller=function(e){var t=$("html"),o=".category-scroller-list",a=$(".category-scroller-container"),i=$(".category-scroller"),n=$(o),s=[],r=$(".store-menu-list-item.heading"),l=($(".category-scroll-blur-left"),$(".category-scroll-blur-right"),0),p=[];function u(){p=[],r.each(function(){p.push(this.getBoundingClientRect().top+t.scrollTop())})}function d(){var e=t.scrollTop();for(l=p.length-1;l>=0;l--)if(e>p[l]-100){s.removeClass("active"),$(s[l]).addClass("active");break}}function c(){console.log(n)}var m=document.createDocumentFragment();for(l=0;l<e.length;l++){var h=$("<li class='store-menu-nav-list-item'>"+e[l].title+"</li>");h.on("click",function(e){var o=$(".store-menu-list-item.heading:contains('"+e.target.innerText+"')"),a=80;screen.width<670&&(a=110),o[0]&&$("html").animate({scrollTop:o[0].getBoundingClientRect().top+t.scrollTop()-a},500)}),m.append(h[0])}n.append(m),new app.controls.HorizontalScroller(o,function(){}),$(window).on("scroll",function(){s.length&&(a[0].getBoundingClientRect().top<20?i.addClass("floating"):i.removeClass("floating"),d())}),$(window).on("resize",function(){u(),d(),c()}),s=$(".store-menu-nav-list-item"),u(),c()},app.controls.Navbar=function(){var e=this;$(".navbar a").on("click",function(t){if("logout"==this.innerText.toLowerCase())return app.routerBase.logUserOut(),!1;var o=this.href.replace(window.location.origin,"");return e.linkClicked(t,o),!1}),$(".navbar-links-popup-button").on("click",function(){$(".navbar-links-popup").animate({right:0},200)}),$(".navbar-links-popup-close").on("click",function(){$(".navbar-links-popup").animate({right:-250},200)}),$(".navbar-icon").on("click",function(e){e.ctrlKey?window.location.href="/admin-login":window.location.href="/location/Balmoral-4171"})},app.controls.Navbar.prototype.linkClicked=function(){},app.controls.RatingControls={setValue:function(e,t){for(var o=$(e),a=0;a<t;a++)o.children().eq(a).addClass("active")},getValue:function(e){return $(e+" .rating-control-star.active").length},updateRatingControls:function(e){for(var t=0;t<e.length;t++)if(e[t].id_review)for(var o=$(".rating-control-stars.user[data-id='"+e[t].id_review+"']"),a=0;a<e[t].rating;a++)o.children().eq(a).addClass("active")},recreateRatingControlEvents:function(){$(".rating-control-star").off(),$(".rating-control-star").unbind();var e=!1;$(".rating-control-star").on("click",function(){$(this).hasClass("active")||$(this).siblings().hasClass("active")||(e=!0),console.log(e),$(this).removeClass("active"),$(this).siblings().removeClass("active"),$(this).addClass("active"),$(this).prevAll().addClass("active")})}},app.controls.Resizer=function(e,t,o,a){var i=$(t),n=$(o),s=0,r=0,l=!1;i.on("mousedown",function(e){l=!0,s=e.clientX,r=e.clientY,console.log(s,r)}),$(window).on("mousemove",function(e){if(e.preventDefault(),e.stopPropagation(),l){var t=window.innerHeight-e.clientY-a;n.height(t)}}),$(window).on("mouseup",function(){l=!1})},app.controls.HorizontalScroller=function(e,t){var o=!1,a=0,i=0;$(e).on("mousedown",function(e){o=!0,a=e.clientX,i=$(this).scrollLeft()}),$(window).on("mousemove",function(t){o&&(t.stopPropagation(),$(e).scrollLeft(i-(t.clientX-a)))}),$(window).on("mouseup",function(){o=!1}),$(e).on("mouseup",function(e){var o=e.clientX-a;o>=-4&&o<=4&&t(e.target)})},app.controls.Typeahead=function(e){var t=this;this.$typeaheadInput=$("#typeahead-suburb-search"),this.$typeaheadList=$("#typeahead-suburb-list");var o=null;function a(o){var a={suburb:$(o).find(".typeahead-item-suburb").text(),postcode:$(o).find(".typeahead-item-postcode").text()};if(t.$typeaheadList.hide(),t.$typeaheadInput.attr("data-suburb",""),t.$typeaheadInput.attr("data-postcode",""),!a.suburb||!a.postcode)return e(null);t.setValue(a.postcode,a.suburb);var i=encodeURIComponent(a.suburb+"-"+a.postcode);return e(a,i)}this.baseUrl="/api/v1/location?q=",this.$typeaheadList.on("click",function(e){a(e.target)}),this.$typeaheadInput.on("focus",function(){this.setSelectionRange(0,this.value.length)}),this.$typeaheadInput.on("blur",function(){var e=t.getValue();e.suburb&&e.postcode?(console.log("1"),t.setValue(e.postcode,e.suburb)):(t.$typeaheadInput.attr("data-suburb",""),t.$typeaheadInput.attr("data-postcode",""),t.$typeaheadInput.val(""))}),this.$typeaheadInput.on("keyup",function(e){var i=0,n=[],s=$(this).val().toLowerCase();if(27!=e.which)if(13!=e.which)if(38!=e.which)if(40!=e.which)clearTimeout(o),o=setTimeout(function(){if(s){var e=t.baseUrl+s;app.util.ajaxRequest({method:"GET",url:e},function(e,o){if(!e){var a=[];for(i=0;i<o.data.length;i++)a.push("<li class='typeahead-item'><label class='typeahead-item-postcode'>"+o.data[i].postcode+"</label><span>♔</span><label class='typeahead-item-suburb'>"+app.util.toTitleCase(o.data[i].suburb)+"</label></li>");t.$typeaheadList.empty(),a.length>0?(t.$typeaheadList.append(a.join("")),t.$typeaheadList.show()):(t.$typeaheadList.show(),t.$typeaheadList.append("<li class='typeahead-item'>NO RESULTS</li>"))}})}else t.$typeaheadList.hide()},500);else for(n=$(".typeahead-item"),i=n.length-1;i>=0;i--){if($(n[i]).hasClass("active")){$(n[i]).removeClass("active"),$(n[i]).next().addClass("active");break}0==i&&$(n[0]).addClass("active")}else for(n=$(".typeahead-item"),i=0;i<n.length;i++){if($(n[i]).hasClass("active")){$(n[i]).removeClass("active"),$(n[i]).prev().addClass("active");break}i==n.length-1&&$(n[n.length-1]).addClass("active")}else{var r=$(".typeahead-item.active");r.length>0&&a(r[0])}}),$(window).on("mousedown",function(e){"typeahead-item"!=e.target.className&&t.$typeaheadList.hide()}),$(window).on("keydown",function(e){27==e.which&&t.$typeaheadList.hide()})},app.controls.Typeahead.prototype.setValue=function(e,t){this.$typeaheadInput.val(e+" - "+t),this.$typeaheadInput.attr("data-suburb",t),this.$typeaheadInput.attr("data-postcode",e)},app.controls.Typeahead.prototype.getValue=function(){return{suburb:this.$typeaheadInput.attr("data-suburb"),postcode:this.$typeaheadInput.attr("data-postcode")}};